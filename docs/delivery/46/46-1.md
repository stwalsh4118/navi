# [46-1] PM Core Types and Constants

[Back to task list](./tasks.md)

## Description

Define all core data structures and constants for the PM engine in a new `internal/pm/` package. These types are the foundation for project discovery, snapshot capture, diffing, and event emission. No business logic â€” purely type definitions.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-16 14:24:46 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2026-02-17 07:27:09 | Status Change | Proposed | InProgress | Started implementation | AI_Agent |
| 2026-02-17 07:28:01 | Status Change | InProgress | Review | Implementation complete, internal checks passed | AI_Agent |
| 2026-02-17 09:44:23 | Status Change | Review | Done | Task completed and verified | AI_Agent |

## Requirements

1. Create `internal/pm/types.go` with all core PM types.
2. Define `ProjectSnapshot` struct capturing:
   - Project name (derived from directory basename)
   - Project directory (absolute path)
   - HEAD SHA, branch name, commits ahead, dirty state
   - Current PBI ID, PBI title, task counts (total, done, in-progress)
   - Session status (highest-priority composite status across grouped sessions)
   - Last activity timestamp
   - Session count (number of sessions in this project)
3. Define `TaskCounts` struct: `Total`, `Done`, `InProgress`.
4. Define `Event` struct with:
   - Type (string constant)
   - Timestamp (time.Time)
   - Project name
   - Project directory
   - Payload data (key-value map for event-specific data)
5. Define `EventType` constants: `EventTaskCompleted`, `EventTaskStarted`, `EventCommit`, `EventSessionStatusChange`, `EventPBICompleted`, `EventBranchCreated`, `EventPRCreated`.
6. Define `PMOutput` struct containing `[]ProjectSnapshot` and `[]Event`.
7. All types must have JSON struct tags for serialization.

## Implementation Plan

1. Create `internal/pm/` directory.
2. Create `internal/pm/types.go` with package declaration and all type definitions.
3. Use existing patterns from `internal/session/` and `internal/git/` for struct tag conventions.
4. Event payload uses `map[string]string` for flexibility across event types.

## Test Plan

- TypeScript compilation equivalent: `go build ./internal/pm/...` passes without errors.
- Verify all types are exported and JSON-serializable by writing a simple marshal/unmarshal round-trip test in `test/unit/pm/types_test.go`.

## Verification

- `go test ./internal/pm -run TestPMOutputJSONRoundTrip` passes.
- JSON marshal/unmarshal round-trip validates core PM type serialization.

## Files Modified

- `internal/pm/types.go` (new)
- `internal/pm/types_test.go` (new)
