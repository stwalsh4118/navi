# [11-4] Implement preview toggle keybindings

[Back to task list](./tasks.md)

## Description

Add keyboard handling for toggling the preview pane visibility using `p` or `Tab` keys, and ensure these bindings don't conflict with existing dialog mode handling.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-05 09:48:56 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2026-02-05 09:55:09 | Status Change | Proposed | InProgress | Started implementation | AI_Agent |
| 2026-02-05 09:56:49 | Status Change | InProgress | Review | Implementation complete | AI_Agent |

## Requirements

- `p` key toggles preview pane visibility
- `Tab` key also toggles preview (when not in dialog mode)
- Toggle clears preview content when hiding
- Toggle triggers immediate capture when showing
- Update footer help text to include preview keybinding
- Ensure `Tab` doesn't conflict with dialog input switching

## Implementation Plan

1. Add key handling in Model.Update() for `p` key:
   ```go
   case "p":
       m.previewVisible = !m.previewVisible
       if m.previewVisible {
           return m, capturePreviewCmd(m.sessions[m.cursor].TmuxSession)
       }
       m.previewContent = ""
       return m, nil
   ```
2. Add `Tab` handling outside of dialog mode (currently Tab only works in dialogs)
3. Create `capturePreviewCmd` tea.Cmd that returns a `previewContentMsg`
4. Create `previewContentMsg` message type for the captured output
5. Handle `previewContentMsg` in Update() to store content
6. Update `footerHelp` constant in view.go to include `p preview`

## Test Plan

**Medium task - verify keybindings and state changes:**

- `p` key toggles `previewVisible` state
- Tab key works for toggle outside dialog mode
- Tab key still works for dialog input switching
- Footer help text includes preview keybinding
- Existing keybinding tests pass

## Verification

- [ ] `p` key toggles preview visibility
- [ ] `Tab` toggles preview when not in dialog
- [ ] `Tab` still switches dialog inputs
- [ ] Footer help text updated
- [ ] Code quality checks pass
- [ ] Tests pass

## Files Modified

- `model.go` - Added previewContentMsg type, capturePreviewCmd function, and p/tab key handling
- `view.go` - Updated footerHelp to include preview keybinding
- `model_test.go` - Added TestPreviewToggle tests
