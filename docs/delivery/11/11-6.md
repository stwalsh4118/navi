# [11-6] Add preview content polling

[Back to task list](./tasks.md)

## Description

Implement periodic refresh of preview content while the preview pane is visible, with debouncing when the cursor moves rapidly through the session list.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-05 09:48:56 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2026-02-05 09:58:49 | Status Change | Proposed | InProgress | Started implementation | AI_Agent |
| 2026-02-05 10:00:16 | Status Change | InProgress | Review | Implementation complete | AI_Agent |

## Requirements

- Poll preview content every 1-2 seconds when preview is visible
- Trigger immediate capture when cursor moves to different session
- Debounce rapid cursor movements (don't capture for each keystroke)
- Don't poll when preview is hidden
- Don't poll when no sessions exist
- Cache content briefly to avoid redundant captures

## Implementation Plan

1. Create `previewTickMsg` message type for preview-specific ticks
2. Create `previewTickCmd()` that fires on `previewPollInterval`
3. Modify `Init()` to start preview tick if preview is visible
4. Handle `previewTickMsg` in Update():
   - Skip if preview not visible
   - Skip if no sessions
   - Capture current session's pane
5. Add debouncing for cursor movement:
   - Track `previewLastCursor` to detect cursor changes
   - Use `previewDebounceDelay` before capturing after cursor change
   - Use `tea.Tick` for delayed capture
6. Modify cursor movement handlers (up/down/j/k) to:
   - Clear current preview content
   - Schedule debounced capture

## Test Plan

**Medium task - verify polling behavior:**

- Preview updates periodically when visible
- Preview stops polling when hidden
- Cursor movement triggers capture (with debounce)
- Rapid cursor movement doesn't cause excessive captures
- No polling when no sessions exist

## Verification

- [ ] Preview content updates periodically
- [ ] Polling stops when preview hidden
- [ ] Cursor change triggers capture
- [ ] Debouncing works for rapid navigation
- [ ] Code quality checks pass
- [ ] Tests pass

## Files Modified

- `model.go` - Added previewTickMsg/previewDebounceMsg types, updated cursor handlers and toggle
- `sessions.go` - Added previewTickCmd() and previewDebounceCmd() functions
- `model_test.go` - Added TestPreviewPolling tests
