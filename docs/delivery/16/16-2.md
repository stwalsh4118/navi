# [16-2] Implement git status collection functions

[Back to task list](./tasks.md)

## Description

Create functions to gather git information from a working directory. This includes executing git commands to retrieve branch name, dirty status, ahead/behind counts, last commit, and remote URL. Handle non-git directories gracefully by returning nil/empty GitInfo.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-05 11:30:11 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2026-02-05 11:35:52 | Status Change | Proposed | InProgress | Started implementation | AI_Agent |
| 2026-02-05 11:37:05 | Status Change | InProgress | Review | Implementation complete, ready for review | AI_Agent |
| 2026-02-05 12:45:00 | Status Change | Review | Done | Task completed and verified | AI_Agent |

## Requirements

- Implement `getGitInfo(dir string) *GitInfo` function that:
  - Checks if directory is a git repository
  - Retrieves current branch: `git rev-parse --abbrev-ref HEAD`
  - Checks dirty status: `git status --porcelain`
  - Gets ahead/behind: `git rev-list --left-right --count @{u}...HEAD`
  - Gets last commit: `git log -1 --format="%h %s"`
  - Gets remote URL: `git remote get-url origin`
- Return nil for non-git directories
- Handle errors gracefully (missing remote, detached HEAD, etc.)
- Run git commands with explicit working directory

## Implementation Plan

1. Implement `isGitRepo(dir string) bool` to check for .git directory
2. Implement individual git command wrappers:
   - `getGitBranch(dir string) string`
   - `isGitDirty(dir string) bool`
   - `getGitAheadBehind(dir string) (ahead, behind int)`
   - `getGitLastCommit(dir string) string`
   - `getGitRemote(dir string) string`
3. Combine into `getGitInfo(dir string) *GitInfo`
4. Add error handling for edge cases

## Test Plan

- Unit tests for each git command wrapper
- Test with git repo directory returns valid GitInfo
- Test with non-git directory returns nil
- Test error handling (no remote, detached HEAD, etc.)

## Verification

- [ ] isGitRepo correctly identifies git repositories
- [ ] Branch name retrieved correctly
- [ ] Dirty status detected correctly
- [ ] Ahead/behind counts retrieved correctly
- [ ] Last commit info retrieved correctly
- [ ] Remote URL retrieved correctly
- [ ] Non-git directories handled gracefully
- [ ] Code quality checks pass
- [ ] Tests pass

## Files Modified

- `git.go` - Added git status collection functions (isGitRepo, getGitBranch, isGitDirty, getGitAheadBehind, getGitLastCommit, getGitRemote, getGitInfo)
- `git_test.go` - Added unit tests for git collection functions
