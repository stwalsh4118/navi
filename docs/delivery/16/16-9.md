# [16-9] Implement diff preview in git detail view

[Back to task list](./tasks.md)

## Description

Add diff preview functionality to the git detail view. Show file change summary and diff stats when user presses `d`. Use git commands to retrieve diff information and display in a scrollable view.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-05 11:30:11 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2026-02-05 11:45:50 | Status Change | Proposed | InProgress | Started implementation | AI_Agent |
| 2026-02-05 12:15:00 | Status Change | InProgress | Review | Implementation complete, ready for review | AI_Agent |
| 2026-02-05 12:45:00 | Status Change | Review | Done | Task completed and verified | AI_Agent |

## Requirements

- `d` key in git detail view shows diff preview
- Show `git diff --stat` output (file changes summary)
- Option to show full diff (may need scrolling)
- Use existing preview pane rendering patterns
- Handle large diffs gracefully (truncate with message)
- `Esc` returns to git detail view (or closes if already in detail)

## Implementation Plan

1. Add `gitDiffMode` bool to Model (or submode of git detail view)
2. Implement `getGitDiffStat(dir string) string` command
3. Implement `getGitDiff(dir string) string` command
4. Create `renderGitDiff(diff string, width, height int) string`
5. Add `d` keybinding in git detail view
6. Handle large diffs with truncation and "... truncated" message
7. Add scrolling if diff is longer than view height

## Test Plan

- d key shows diff stat in git detail view
- Diff stat renders correctly
- Large diffs truncated appropriately
- Clean repos show "No changes" message
- Esc returns to previous view

## Verification

- [x] d keybinding implemented in git detail view
- [x] getGitDiffStat function works
- [x] Diff preview renders correctly
- [x] Large diffs handled gracefully
- [x] Navigation between views works
- [x] Code quality checks pass
- [x] Tests pass

## Files Modified

- `dialog.go` - Added DialogGitDiff mode and title
- `git.go` - Added getGitDiffStat(), getGitDiff() functions and diff constants
- `git_test.go` - Added tests for diff functions
- `model.go` - Added 'd' keybinding handler and escape handling for DialogGitDiff
- `view.go` - Added renderGitDiffView() function and DialogGitDiff case in renderDialog()
- `view_test.go` - Added tests for renderGitDiffView()
