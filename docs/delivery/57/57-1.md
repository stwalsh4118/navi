# [57-1] ResourceMetrics Type and FormatBytes Helper

[Back to task list](./tasks.md)

## Description

Add a `ResourceMetrics` struct to the `internal/metrics` package with an `RSSBytes int64` field, add a `FormatBytes()` function for human-readable byte formatting, and add a `Resource *ResourceMetrics` field to the existing `Metrics` struct.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-19 08:35:20 | Created | N/A | Proposed | Task file created | AI_Agent |

## Requirements

1. Define `ResourceMetrics` struct with `RSSBytes int64` field (JSON tag: `rss_bytes`)
2. Add `Resource *ResourceMetrics` field to `Metrics` struct (JSON tag: `resource,omitempty`)
3. Implement `FormatBytes(bytes int64) string` that returns human-readable format:
   - < 1 KiB → `"0"` (or exact bytes if nonzero but very small — edge case)
   - 1 KiB–999 KiB → `"512K"`
   - 1 MiB–999 MiB → `"256M"`
   - ≥ 1 GiB → `"1.2G"` (one decimal)
4. Add unit tests for `FormatBytes` covering boundary values

## Implementation Plan

**File**: `internal/metrics/metrics.go`

1. Add `ResourceMetrics` struct after existing metric types
2. Add `Resource *ResourceMetrics` field to `Metrics` struct
3. Add `FormatBytes()` function following the pattern of existing `FormatTokenCount()` and `FormatDuration()`

**File**: `internal/metrics/metrics_test.go` (or create if not exists)

4. Add table-driven tests for `FormatBytes` covering: 0, 512 bytes, 1023 bytes, 1 KiB, 512 KiB, 1 MiB, 256 MiB, 999 MiB, 1 GiB, 1.5 GiB, 10 GiB

## Test Plan

- **Unit tests**: Table-driven tests for `FormatBytes()` covering all format tiers and boundary values
- **Compilation**: Verify `go build ./...` passes with new types integrated into `Metrics` struct

## Verification

- [ ] `ResourceMetrics` struct defined with `RSSBytes int64`
- [ ] `Metrics.Resource` field added with `omitempty` JSON tag
- [ ] `FormatBytes()` returns correct human-readable strings for all tiers
- [ ] Unit tests pass
- [ ] `go vet ./...` clean

## Files Modified

- `internal/metrics/metrics.go` — new type + format function
- `internal/metrics/metrics_test.go` — unit tests for FormatBytes
