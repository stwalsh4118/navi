# [27-6] TUI integration for remote actions

[Back to task list](./tasks.md)

## Description

Wire up the kill (`x`), rename (`R`), and dismiss (`d`) keybindings to work for remote sessions. Currently, all three have early returns that skip remote sessions. This task removes those guards and dispatches the actions via SSH using the functions from task 27-3.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-06 16:27:44 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2026-02-06 16:50:00 | Status Change | Proposed | InProgress | Started implementation | AI_Agent |
| 2026-02-06 16:51:00 | Status Change | InProgress | Review | Implementation complete, all tests pass | AI_Agent |
| 2026-02-06 17:38:38 | Status Change | Review | Done | Task completed and verified | AI_Agent |

## Requirements

### Kill (`x` key)
- Remove the `if s.Remote != "" { return m, nil }` early return
- When `x` is pressed on a remote session, show the same `DialogKillConfirm` dialog
- On confirmation (`y`), dispatch `remote.KillSession()` via SSH
- Handle result with same success/error feedback as local kill
- Get `sessionsDir` from `m.SSHPool.GetRemoteConfig(s.Remote).SessionsDir`

### Rename (`R` key)
- Remove the `if s.Remote != "" { return m, nil }` early return
- When `R` is pressed on a remote session, show the same `DialogRename` dialog with text input
- On confirmation, dispatch `remote.RenameSession()` via SSH
- Apply same validation rules (no empty names, no `.` or `:` characters, no duplicates)
- Handle result with same success/error feedback as local rename

### Dismiss (`d` key)
- Remove the `if s.Remote != "" { return m, nil }` early return
- When `d` is pressed on a remote session, dispatch `remote.DismissSession()` via SSH
- Immediate action (no confirmation dialog), same as local dismiss
- Trigger session refresh after dismiss

### Footer
- Update footer help text: show `d dismiss`, `x kill`, `R rename`, `G git` for remote sessions too (currently only shown for local)
- Remove the `if !isRemoteSelected` guard in the footer rendering

### General
- All SSH actions must use the existing `SSHPool` via `m.SSHPool`
- Look up remote config via `m.SSHPool.GetRemoteConfig(s.Remote)` for `sessionsDir`
- If remote config lookup fails, show error in dialog

## Implementation Plan

1. **Kill**: In `model.go`:
   - Remove early return for remote sessions in `x` key handler
   - Add `killRemoteSessionCmd(pool *SSHPool, remoteName, sessionName, sessionsDir string) tea.Cmd` in `sessions.go`
   - In the kill confirmation handler, check if `m.sessionToModify.Remote != ""` and dispatch remote kill
   - Reuse `killSessionResultMsg` for the result
2. **Rename**: In `model.go`:
   - Remove early return for remote sessions in `R` key handler
   - Add `renameRemoteSessionCmd(pool *SSHPool, remoteName, oldName, newName, sessionsDir string) tea.Cmd` in `sessions.go`
   - In `submitRename()`, check if `m.sessionToModify.Remote != ""` and dispatch remote rename
   - Reuse `renameSessionResultMsg` for the result
3. **Dismiss**: In `model.go`:
   - Remove early return for remote sessions in `d` key handler
   - Add `dismissRemoteSessionCmd(pool *SSHPool, remoteName, sessionName, sessionsDir string) tea.Cmd` in `sessions.go`
   - Dispatch remote dismiss and trigger poll on completion
   - Add a new message type for async dismiss result (local dismiss is synchronous but remote needs to be async)
4. **Footer**: In `view.go`:
   - Remove `if !isRemoteSelected` guard
   - Show all action keybindings regardless of session type

## Test Plan

- **Unit tests**:
  - `x` key on remote session opens kill dialog (not early return)
  - `R` key on remote session opens rename dialog (not early return)
  - `d` key on remote session dispatches remote dismiss (not early return)
  - Kill confirmation dispatches remote kill when session is remote
  - Rename submit dispatches remote rename when session is remote
  - Validation rules still apply for remote rename
  - Footer shows all keybindings for remote sessions
  - Error messages shown in dialogs on SSH failure
- **Integration consideration**: Full E2E flow tested in task 27-7

## Verification

- [ ] `x` key works on remote sessions with confirmation dialog
- [ ] `R` key works on remote sessions with rename dialog and validation
- [ ] `d` key works on remote sessions with immediate dismiss
- [ ] Footer shows all keybindings for remote sessions
- [ ] SSH errors shown in dialogs, not crashes
- [ ] Same user feedback as local actions
- [ ] Code quality checks pass (`make check`)
- [ ] Unit tests pass

## Files Modified

- `internal/tui/model.go` - Added remoteDismissResultMsg type, removed early returns for d/x/R on remote sessions, updated kill confirm handler, updated submitRename(), added remoteDismissResultMsg handler
- `internal/tui/sessions.go` - Added killRemoteSessionCmd(), renameRemoteSessionCmd(), dismissRemoteSessionCmd()
- `internal/tui/view.go` - Removed isRemoteSelected guard from footer, all keybindings now shown for all sessions
