# [13-5] Integrate filter/sort/search indicators into unified footer display

[Back to task list](./tasks.md)

## Description

Update the TUI footer and header area to display the current filter state, sort mode, search bar, and filtered session count. This provides the user with clear visual feedback about what filters are active and how many sessions are visible.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-06 18:13:35 | Created | N/A | Proposed | Task file created | AI_Agent |

## Requirements

- **Search bar**: When search mode is active, render a search input bar above the session list or in the header area:
  ```
  üîç <search query with cursor>
  ```
  - Styled with a rounded border box
  - Shows the `searchInput` text input view
- **Footer filter indicator**: Update the footer to show active filter/sort state:
  ```
  Filter: permission | Sort: priority | 3/8 shown
  ```
  - Show "Filter: \<status\>" only when a status filter is active
  - Show "Sort: \<mode\>" when sort mode is not the default (Priority)
  - Always show "\<filtered\>/\<total\> shown" when any filter/search is active
- **Session count**: Display the count of visible sessions vs total sessions
  - Format: "X/Y shown" where X is filtered count, Y is total count
  - Only display when X != Y (i.e., some filtering is active)
- **Footer key hints**: Update footer key hints to include new keys:
  - `/` search
  - `s` sort
  - `1-5` filter
  - `o` offline
- **Visual feedback**: When filters are active, use a distinct style (e.g., highlight color) on the filter indicator to make it obvious
- **Cursor preservation**: When filters change, attempt to keep the same session selected if it's still in the filtered list; otherwise reset cursor to 0

## Implementation Plan

1. Update `renderFooter()` in `internal/tui/view.go`:
   - Add key hints for `/`, `s`, `1-5`, `o`
   - Add a filter/sort status section showing active filter, sort mode, and count
   - Style active filters with a highlight color
2. Add `renderSearchBar()` method in `internal/tui/view.go`:
   - Render the search input in a styled box
   - Only called when `m.searchMode` is true
3. Update `View()` to include the search bar above the session list when active
4. Calculate filtered vs total count in the rendering pipeline
5. Implement cursor preservation logic:
   - Before applying new filter, save the currently selected session's ID
   - After filtering, find that session in the new list and set cursor
   - If not found, reset cursor to 0

## Test Plan

- **Objective**: Verify UI elements render correctly for all filter/sort/search states
- **Test Scope**: Footer rendering, search bar rendering, cursor preservation
- **Key Scenarios**:
  - No filters active: footer shows default keys, no filter indicator
  - Status filter active: footer shows "Filter: \<status\>"
  - Sort mode changed: footer shows "Sort: \<mode\>"
  - Search active: search bar visible, footer shows search key hint
  - Combined state: filter + sort + search all active simultaneously
  - Session count: "3/8 shown" when filtering reduces the list
  - Cursor preservation: cursor stays on same session after filter change
  - Cursor reset: cursor goes to 0 when selected session is filtered out
- **Success Criteria**: All UI elements render correctly; footer accurately reflects state

## Verification

- [ ] Search bar renders when search mode is active
- [ ] Footer shows active filter name
- [ ] Footer shows active sort mode (when not default)
- [ ] Footer shows "X/Y shown" count when filtering is active
- [ ] New key hints (/, s, 1-5, o) appear in footer
- [ ] Active filter has distinct visual style
- [ ] Cursor preserves position when possible
- [ ] Cursor resets to 0 when selected session is filtered out
- [ ] Existing tests pass
- [ ] `go build ./...` succeeds

## Files Modified

