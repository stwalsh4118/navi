# [4-3] Implement session row rendering

[Back to task list](./tasks.md)

## Description

Implement rendering for each session row including icon, name, age, working directory, and message.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-05 00:00:00 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2026-02-05 05:36:11 | Status Change | Proposed | InProgress | Started implementation | AI_Agent |
| 2026-02-05 05:36:56 | Status Change | InProgress | Review | Implementation complete, tests pass | AI_Agent |
| 2026-02-05 05:49:16 | Status Change | Review | Done | Task completed and verified | AI_Agent |

## Requirements

Each row displays:
1. Selection marker (`▸` if selected, space otherwise)
2. Status icon (colored)
3. Session name (bold)
4. Age of last update (right-aligned)
5. Working directory (dimmed, on second line)
6. Message if present (dimmed/italic, on third line, truncated)

## Implementation Plan

Implement in `model.go` or `styles.go`:
```go
func (m Model) renderSession(s SessionInfo, selected bool, width int) string {
    var b strings.Builder

    // Selection marker
    marker := "  "
    if selected {
        marker = "▸ "
    }

    // First line: marker + icon + name + age
    icon := statusIcon(s.Status)
    name := boldStyle.Render(s.TmuxSession)
    age := formatAge(s.Timestamp)

    // Calculate padding for right-aligned age
    firstLine := fmt.Sprintf("%s%s  %s", marker, icon, name)
    padding := width - lipgloss.Width(firstLine) - len(age) - 2
    if padding < 1 {
        padding = 1
    }

    b.WriteString(firstLine)
    b.WriteString(strings.Repeat(" ", padding))
    b.WriteString(age)
    b.WriteString("\n")

    // Second line: working directory (indented, dimmed)
    cwd := shortenPath(s.CWD)
    b.WriteString("      ")
    b.WriteString(dimStyle.Render(cwd))
    b.WriteString("\n")

    // Third line: message if present (indented, dimmed/italic)
    if s.Message != "" {
        msg := truncate(s.Message, width-6)
        b.WriteString("      ")
        b.WriteString(dimStyle.Render(italicStyle.Render(fmt.Sprintf("\"%s\"", msg))))
    }

    return b.String()
}

func formatAge(timestamp int64) string {
    elapsed := time.Since(time.Unix(timestamp, 0))
    if elapsed < time.Minute {
        return fmt.Sprintf("%ds ago", int(elapsed.Seconds()))
    }
    if elapsed < time.Hour {
        return fmt.Sprintf("%dm ago", int(elapsed.Minutes()))
    }
    return fmt.Sprintf("%dh ago", int(elapsed.Hours()))
}

func shortenPath(path string) string {
    home, _ := os.UserHomeDir()
    if strings.HasPrefix(path, home) {
        return "~" + path[len(home):]
    }
    return path
}

func truncate(s string, maxLen int) string {
    if len(s) <= maxLen {
        return s
    }
    return s[:maxLen-3] + "..."
}
```

## Test Plan

- **Objective**: Verify session rows render correctly
- **Test Scenarios**:
  1. Selected row shows ▸ marker
  2. Age formats correctly (seconds, minutes, hours)
  3. Path shortening works with ~
  4. Long messages are truncated
- **Success Criteria**: Layout matches PRD mockup

## Verification

- [ ] Selection marker renders correctly
- [ ] Icon, name, age on first line
- [ ] Age is right-aligned
- [ ] CWD on second line, dimmed
- [ ] Message on third line if present
- [ ] Path shortened with ~
- [ ] Message truncated at width

## Files Modified

- `view.go` - Created with renderSession(), formatAge(), shortenPath(), truncate() functions
- `view_test.go` - Created with TestFormatAge, TestShortenPath, TestTruncate, TestRenderSession tests
