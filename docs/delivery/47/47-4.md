# [47-4] Focus System and Tab Navigation

[Back to task list](./tasks.md)

## Description

Implement Tab-based focus switching between Zone 2 (projects) and Zone 3 (events) in the PM view. Add visual focus indicators (border color change) and proper keyboard routing so that navigation keys go to the focused zone.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-17 10:45:13 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2026-02-17 11:10:16 | Status Change | Proposed | InProgress | Started implementation | AI_Agent |
| 2026-02-17 11:10:16 | Status Change | InProgress | Review | Implementation complete, internal AI review passed | AI_Agent |
| 2026-02-17 23:47:43 | Status Change | Review | Done | Task completed and verified | AI_Agent |

## Requirements

1. Tab key cycles focus between Zone 2 (default) and Zone 3. Zone 1 (briefing) is never focused.
2. Visual focus indicator: focused zone box uses `pmFocusedBoxStyle` (green border, matching `previewFocusedBoxStyle` pattern). Unfocused zones use `pmBoxStyle` (gray border).
3. Keyboard routing when PM view is visible:
   - Zone 2 focused: ↑/↓ moves project cursor, Enter jumps to sessions, Space expands (47-5).
   - Zone 3 focused: j/k/↑/↓ scrolls events, PgUp/PgDn for page scroll, g/G for top/bottom.
4. Esc exits PM view (sets `pmViewVisible = false`), returning to session list.
5. `P` also toggles PM view off from within.
6. `pmZoneFocus` defaults to 0 (projects) when PM view is opened.
7. Add a `updatePMView(msg tea.KeyMsg) (Model, tea.Cmd)` method for clean separation of PM view keybinding handling, called from `Update()` when `pmViewVisible` is true.

## Implementation Plan

1. Add `updatePMView()` method in `pmview.go` handling all PM view keybindings.
2. Add routing in `Update()`: when `pmViewVisible`, delegate to `updatePMView()` before main keybindings.
3. Apply focused/unfocused box styles in `renderPMProjects()` and `renderPMEvents()` based on `pmZoneFocus`.
4. Reset `pmZoneFocus` to 0 when PM view is opened.

## Test Plan

- Unit test: Tab toggles `pmZoneFocus` between 0 and 1.
- Unit test: Esc sets `pmViewVisible` to false.
- Unit test: `updatePMView()` routes ↑/↓ to project cursor when `pmZoneFocus == 0`.
- Unit test: `updatePMView()` routes j/k to event scroll when `pmZoneFocus == 1`.
- Unit test: Focused zone renders with green border style.

## Verification

- Added `updatePMView(msg tea.KeyMsg)` for PM key routing and wired it in `Update()` when PM view is visible.
- Implemented Tab focus toggle between projects/events, Esc/P close, and focus-aware zone border rendering.
- Added tests for Tab focus changes and Esc close behavior.
- Verification commands:
  - `go test ./internal/tui/... -run TestPMTabFocusAndEscClose`
  - `go test ./...`

## Files Modified

- `internal/tui/pmview.go` — `updatePMView()` keybinding handler, focus-aware rendering
- `internal/tui/model.go` — routing in `Update()` to delegate to `updatePMView()`
