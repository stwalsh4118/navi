# [47-3] Events Zone Rendering

[Back to task list](./tasks.md)

## Description

Implement Zone 3 (events) of the PM view. Renders events from `pmOutput.Events` in reverse chronological order, color-coded by event type. The zone is scrollable with j/k and arrow keys when focused.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-17 10:45:13 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2026-02-17 11:10:16 | Status Change | Proposed | InProgress | Started implementation | AI_Agent |
| 2026-02-17 11:10:16 | Status Change | InProgress | Review | Implementation complete, internal AI review passed | AI_Agent |
| 2026-02-17 23:47:43 | Status Change | Review | Done | Task completed and verified | AI_Agent |

## Requirements

1. Replace Zone 3 placeholder with event log rendering in `renderPMEvents()`.
2. Events displayed in reverse chronological order (newest first).
3. Each event row shows:
   - Timestamp (relative, e.g., "2m ago" or "1h ago")
   - Color-coded event type icon/label:
     - Green: `task_completed`, `task_started`, `pbi_completed`
     - Yellow: `session_status_change`
     - Cyan: `commit`, `branch_created`, `pr_created`
   - Project name (dimmed)
   - Event-specific detail from `Payload` map (e.g., task name, commit message, branch name)
4. Scrollable when zone is focused: j/k and ↑/↓ move `pmEventScrollOffset`.
5. Scroll indicators (↑ N above / ↓ N below) when events extend beyond zone height, matching existing scroll indicator pattern.
6. Show "No events yet" in dim text when events list is empty.
7. Read events from `pmOutput.Events` (already loaded by PM engine pipeline from PBI-46).

## Implementation Plan

1. Implement `renderPMEvents(width, height int) string` in `pmview.go`.
2. Add event type to color mapping function.
3. Add event detail formatter that extracts meaningful text from `Payload` map per event type.
4. Add scroll handling for events zone in PM view keybinding handler (when `pmZoneFocus == 1`).
5. Reuse existing scroll indicator constants (`scrollIndicatorAbove`, `scrollIndicatorBelow`).

## Test Plan

- Unit test: Events render in reverse chronological order.
- Unit test: Event types are color-coded correctly (green for task events, yellow for status, cyan for commits).
- Unit test: Event detail formatting extracts correct payload fields per type.
- Unit test: Scroll offset clamps within valid range.
- Unit test: Empty events list renders "No events yet" message.

## Verification

- Implemented reverse-chronological PM events rendering with event-type color mapping and payload detail formatting.
- Added event scroll handling for focused events zone (`j/k`, arrows, `PgUp/PgDn`, `g/G`) and scroll indicators.
- Added tests for event ordering and focus-zone scrolling behavior.
- Verification commands:
  - `go test ./internal/tui/... -run TestPMEventsOrderAndScroll`
  - `go test ./...`

## Files Modified

- `internal/tui/pmview.go` — event rendering, color mapping, scroll handling
