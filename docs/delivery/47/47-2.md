# [47-2] Projects Zone Rendering and Navigation

[Back to task list](./tasks.md)

## Description

Implement Zone 2 (projects) of the PM view. Renders one row per project from `pmOutput.Snapshots` with columns: status icon, name, PBI ID + title, progress (done/total), session status, last activity. Projects are sorted by attention priority. Cursor navigation with ↑/↓, and Enter jumps to the session list filtered by the selected project's directory.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-17 10:45:13 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2026-02-17 11:10:16 | Status Change | Proposed | InProgress | Started implementation | AI_Agent |
| 2026-02-17 11:10:16 | Status Change | InProgress | Review | Implementation complete, internal AI review passed | AI_Agent |
| 2026-02-17 23:47:43 | Status Change | Review | Done | Task completed and verified | AI_Agent |

## Requirements

1. Replace Zone 2 placeholder with project row rendering in `renderPMProjects()`.
2. Each row displays (left to right):
   - Status icon (reuse `StatusIcon()` from `styles.go` based on `SessionStatus`)
   - Project name (bold)
   - PBI ID + title (e.g., "PBI-29: Content Viewer") — truncate title on narrow terminals
   - Progress bar or fraction (e.g., "3/5 tasks")
   - Session count
   - Last activity (relative timestamp, e.g., "5m ago")
3. Sort projects by attention priority:
   - Sessions needing attention first (permission > error > waiting > working > idle > offline)
   - Within same priority: most recent activity first
4. Cursor navigation: ↑/↓ moves `pmProjectCursor` through the project list.
5. Scroll support: when project list exceeds zone height, scroll with `pmProjectScrollOffset`.
6. Selected row highlighted with `selectedStyle` (background color, matching session list pattern).
7. Enter on a selected project: hide PM view, set a search/filter to show only sessions matching that project's directory, return to session list.
8. Show "No projects detected" in dim text when `pmOutput` is nil or has no snapshots.

## Implementation Plan

1. Implement `renderPMProjects(width, height int) string` in `pmview.go`.
2. Add attention-priority sort function for `[]pm.ProjectSnapshot`.
3. Add cursor movement handling in the PM view keybinding handler (when `pmViewVisible && pmZoneFocus == 0`).
4. Implement Enter-to-jump: set `pmViewVisible = false`, apply project directory filter to session list.
5. Handle empty state gracefully.

## Test Plan

- Unit test: `renderPMProjects()` renders correct columns for sample snapshots.
- Unit test: Projects are sorted by attention priority (permission before working before idle).
- Unit test: Cursor wraps or clamps at list boundaries.
- Unit test: Empty snapshot list renders "No projects detected" message.
- Unit test: Enter action sets `pmViewVisible = false` and applies correct filter.

## Verification

- Implemented project-zone rendering with attention-priority sort, cursor navigation, row highlighting, and project filtering on Enter.
- Added PM project filter integration to session filtering pipeline and Esc clear behavior.
- Added integration coverage for Enter path and filtered session behavior.
- Verification commands:
  - `go test ./internal/tui/... -run TestPMProjectsSortAndSelectionJump`
  - `go test ./...`

## Files Modified

- `internal/tui/pmview.go` — project row rendering, sorting, cursor handling
- `internal/tui/model.go` — Enter-to-jump logic, PM view keybinding routing
