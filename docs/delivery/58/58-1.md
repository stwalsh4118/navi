# [58-1] Audio SetPack and SavePackSelection

[Back to task list](./tasks.md)

## Description

Add two new capabilities to the audio package:

1. `Notifier.SetPack(packName string) error` — hot-swap the active sound pack at runtime. Must be thread-safe (existing mutex). Resolves new pack files via `ResolveSoundFiles()` and replaces `packFiles` map atomically.
2. `SavePackSelection(configPath, packName string) error` — read the existing `sounds.yaml`, update only the `pack:` field, and write back. Must preserve all other user settings (volume, triggers, files, TTS, cooldown, player, engine). Create the file with sensible defaults if it doesn't exist.

These are foundational APIs consumed by the TUI picker in subsequent tasks.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-19 06:54:06 | Created | N/A | Proposed | Task file created | AI_Agent |

## Requirements

1. `SetPack(packName string) error` on `*Notifier`:
   - Acquire mutex, call `ResolveSoundFiles(packName)`, replace `packFiles`, update `cfg.Pack`, release mutex
   - If packName is empty, clear packFiles (revert to no-pack state)
   - Return error if `ResolveSoundFiles` fails (caller can show in dialog)
2. `SavePackSelection(configPath, packName string) error`:
   - Read existing YAML file (or start from `DefaultConfig()` if missing)
   - Unmarshal, set `Pack` field, marshal, write back
   - Preserve file permissions
3. Thread-safety: both methods must be safe for concurrent use
4. No new external dependencies

## Implementation Plan

**Files to modify:**
- `internal/audio/notifier.go` — add `SetPack()` method
- `internal/audio/config.go` — add `SavePackSelection()` function

**Steps:**
1. Add `SetPack(packName string) error` to `Notifier` in `notifier.go`
2. Add `SavePackSelection(configPath, packName string) error` to `config.go`
3. Add unit tests for both functions

## Test Plan

- **SetPack with valid pack**: verify `packFiles` updated, `cfg.Pack` updated
- **SetPack with empty string**: verify `packFiles` cleared
- **SetPack with invalid pack**: verify error returned, existing state unchanged
- **SavePackSelection**: verify YAML written with correct pack field, other fields preserved
- **SavePackSelection with missing file**: verify file created with defaults + pack

## Verification

- [ ] `go test ./internal/audio/ -run TestSetPack -race` passes
- [ ] `go test ./internal/audio/ -run TestSavePackSelection -race` passes
- [ ] `go vet ./internal/audio/` clean

## Files Modified

_(to be filled during implementation)_
