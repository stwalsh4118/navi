# [58-2] Dialog Enum and Model State

[Back to task list](./tasks.md)

## Description

Wire up the sound pack picker as a new dialog mode in the TUI. Add the `DialogSoundPackPicker` enum value, picker state fields to `Model`, the `S` keybind to open the picker, and the `loadSoundPacks` command that fetches the pack list.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-19 06:54:06 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2026-02-19 07:19:25 | Status Change | Proposed | InProgress | Started implementation | AI_Agent |
| 2026-02-19 07:21:10 | Status Change | InProgress | Review | Implementation complete, internal AI review passed | AI_Agent |
| 2026-02-19 07:52:28 | Status Change | Review | Done | Task completed and verified | AI_Agent |

## Requirements

1. Add `DialogSoundPackPicker` to `DialogMode` enum in `dialog.go` with title "Sound Packs"
2. Add picker state fields to `Model` in `model.go`:
   - `soundPacks []audio.PackInfo` — loaded pack list
   - `soundPackCursor int` — current selection index
   - `soundPackScrollOffset int` — viewport scroll offset
   - `activeSoundPack string` — currently active pack name (from config)
3. Add `S` keybind in the main Update switch (session view, no active dialog):
   - Set `dialogMode = DialogSoundPackPicker`
   - Reset cursor and scroll to 0
   - Return a `tea.Cmd` that calls `audio.ListPacks()` and returns a `soundPacksMsg`
4. Define `soundPacksMsg` type and handle it in `Update` to populate `soundPacks` and set `activeSoundPack` from `audioNotifier` config
5. Read `activeSoundPack` from the notifier's config at init time

## Implementation Plan

**Files to modify:**
- `internal/tui/dialog.go` — add enum value and title
- `internal/tui/model.go` — add state fields, keybind, message type, message handler

**Steps:**
1. Add `DialogSoundPackPicker` to enum and `DialogTitle()` switch
2. Add picker state fields to `Model` struct
3. Add `soundPacksMsg` type (wraps `[]audio.PackInfo` + `error`)
4. Add `S` keybind case that sets dialog mode and fires load command
5. Handle `soundPacksMsg` in main `Update` to populate state
6. Initialize `activeSoundPack` from loaded audio config during `NewModel()`

## Test Plan

- **Keybind opens picker**: Send `S` key, verify `dialogMode == DialogSoundPackPicker`
- **Pack list loaded**: Verify `soundPacksMsg` populates `soundPacks` field
- **Dialog blocks main keys**: Verify main keybindings are blocked when picker is open

## Verification

- [ ] `go build ./...` compiles without errors
- [ ] `go vet ./internal/tui/` clean
- [ ] Keybind dispatches correctly (verified in task 58-5)

## Files Modified

- `internal/tui/dialog.go` — added `DialogSoundPackPicker` enum and title
- `internal/tui/model.go` — added picker state fields, `soundPacksMsg` type, `S` keybind, `loadSoundPacksCmd()`, message handler, `activeSoundPack` init
