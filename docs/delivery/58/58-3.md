# [58-3] Picker Update Logic

[Back to task list](./tasks.md)

## Description

Implement the keyboard handling logic for the sound pack picker dialog. This covers navigation (up/down/scroll), selection (Enter to apply pack), preview (p to play a sample sound), and dismissal (Esc to cancel).

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-19 06:54:06 | Created | N/A | Proposed | Task file created | AI_Agent |

## Requirements

1. Route `DialogSoundPackPicker` in `updateDialog()` to a dedicated handler
2. **Navigation**: Up/k and Down/j move cursor through pack list with scroll offset management
3. **Selection (Enter)**:
   - Call `m.audioNotifier.SetPack(selectedPackName)` to hot-swap
   - Call `audio.SavePackSelection(audio.DefaultConfigPath, selectedPackName)` to persist
   - Update `m.activeSoundPack`
   - Close dialog on success; show `dialogError` on failure
4. **Preview (p or Space)**:
   - Pick a random sound file from the highlighted pack (use `ResolveSoundFiles`)
   - Play it via `m.audioNotifier` player at current volume
   - Non-blocking (fire-and-forget command)
5. **Cancel (Esc)**: Close dialog without changes
6. Handle empty pack list gracefully (only Esc works)

## Implementation Plan

**Files to modify:**
- `internal/tui/model.go` â€” add `updateSoundPackPicker(msg tea.KeyMsg)` and wire into `updateDialog`

**Steps:**
1. Add `updateSoundPackPicker(msg tea.KeyMsg) (Model, tea.Cmd)` method
2. Implement up/down navigation with bounds checking and scroll offset
3. Implement Enter handler: call SetPack + SavePackSelection, update activeSoundPack, closeDialog
4. Implement preview handler: resolve pack files, play random sound via command
5. Implement Esc handler: closeDialog
6. Wire `DialogSoundPackPicker` case in `updateDialog` to the new method

## Test Plan

- **Up/Down navigation**: Verify cursor moves within bounds, scroll offset adjusts
- **Enter selects pack**: Verify SetPack called, activeSoundPack updated, dialog closed
- **Esc cancels**: Verify dialog closed, activeSoundPack unchanged
- **Empty list**: Verify only Esc works, no panic on Enter/navigation

## Verification

- [ ] `go build ./...` compiles without errors
- [ ] `go vet ./internal/tui/` clean
- [ ] Navigation and selection verified in task 58-5

## Files Modified

_(to be filled during implementation)_
