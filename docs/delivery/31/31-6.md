# [31-6] E2E CoS Test

[Back to task list](./tasks.md)

## Description

End-to-end verification of all PBI-31 acceptance criteria, ensuring vim-style exact-match search works correctly across both session list and task panel.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-07 16:37:51 | Created | N/A | Proposed | Task file created | AI_Agent |

## Requirements

Verify all 12 acceptance criteria from the PBI:

1. `/` enters search mode; typing produces exact case-insensitive substring matches
2. All items remain visible during search (no filtering)
3. Matching items are visually highlighted in the list
4. `n` jumps cursor to next match, `N` jumps to previous match
5. Match cycling wraps around (last -> first, first -> last)
6. A match counter (e.g., "2/5") is displayed showing current position and total matches
7. `Esc` exits search mode and clears highlights
8. `Enter` on a match performs the default action and search persists
9. Only `Esc` clears the search state
10. Fuzzy search is fully removed — no legacy fuzzy matching code remains
11. Works in both session list and task panel
12. Existing status filters (1-5 keys), sort, and offline toggle continue to work independently of search

## Implementation Plan

1. Write E2E test scenarios covering each acceptance criterion
2. Test session list search: enter query, verify all sessions visible, verify highlights, cycle with n/N, verify counter
3. Test task panel search: same as above in task panel context
4. Test search persistence: Enter to attach, verify search survives, Esc to clear
5. Test filter interaction: apply status filter + search, verify both work independently
6. Test edge cases: no matches, single match, empty query
7. Verify no `fuzzyMatch`/`fuzzyFilter` references remain via grep

## Test Plan

This task IS the test plan — comprehensive E2E verification of all acceptance criteria.

### Test Scenarios

1. **Exact match**: Search "api" matches "api-server" but not "application"
2. **Case insensitivity**: Search "API" matches "api-server"
3. **All items visible**: Search doesn't reduce the list length
4. **n/N cycling**: With 3 matches, pressing n 4 times wraps back to first
5. **Match counter**: Shows correct "[1/3]" format, updates on n/N
6. **Persistence**: Enter attaches session, re-entering TUI shows search still active
7. **Esc clears**: After Esc, no highlights, no match counter, n reverts to new session
8. **Filter + search**: Status filter active + search active, both work correctly
9. **Task panel**: Same behaviours verified in task panel context
10. **No fuzzy code**: `grep -r "fuzzyMatch\|fuzzyFilter" internal/` returns nothing

## Verification

- [ ] All 12 acceptance criteria verified
- [ ] Session list search works correctly
- [ ] Task panel search works correctly
- [ ] Search persistence confirmed
- [ ] Filter independence confirmed
- [ ] No legacy fuzzy code found
- [ ] All tests pass with `-race`

## Files Modified

