# [29-5] E2E CoS Test

[Back to task list](./tasks.md)

## Description

End-to-end verification that all acceptance criteria for PBI 29 are met. This task validates the complete in-app content viewer feature across all integration points.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-07 14:10:17 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2026-02-07 14:26:06 | Status Change | Proposed | InProgress | Started implementation | AI_Agent |
| 2026-02-07 14:45:00 | Status Change | InProgress | Review | All 6 AC tests pass with race detection, go vet clean | AI_Agent |
| 2026-02-07 15:41:24 | Status Change | Review | Done | Task completed and verified | AI_Agent |

## Requirements

Verify all PBI 29 acceptance criteria:

1. A reusable content viewer component exists that can display arbitrary text with scrolling
2. Pressing enter on a task in the task view opens the task's detail file in the viewer
3. The viewer supports j/k, up/down, page up/down, g/G, and Esc keybindings
4. Git diffs can be displayed with addition/deletion coloring
5. The viewer adapts to terminal resize events
6. Esc closes the viewer and returns to the previous screen

## Implementation Plan

1. Write E2E test functions in `internal/tui/e2e_contentviewer_test.go`
2. Test the content viewer component directly:
   - Initialize with sample text content, verify rendering includes title and content
   - Verify scroll navigation updates visible content
   - Verify Esc closes the viewer
3. Test task panel integration:
   - Set up model with task groups containing tasks with file paths
   - Simulate Enter key, verify content viewer opens with file content
4. Test diff coloring:
   - Initialize content viewer with sample diff content in diff mode
   - Verify rendered output contains colored diff lines
5. Test resize handling:
   - Change model width/height, verify viewer adapts
6. Run all tests with `go test -race ./internal/tui/`

## Test Plan

### Objective
Validate that all 6 acceptance criteria from PBI 29 are met through automated E2E tests.

### Test Scenarios

**AC1 - Reusable content viewer with scrolling:**
- Open content viewer with multi-line text exceeding viewport height
- Verify content is displayed and scrolling works

**AC2 - Task enter opens detail file:**
- Configure task panel with a task pointing to a local file
- Press Enter, verify content viewer opens with file content

**AC3 - Keybindings:**
- Test j/k scroll one line
- Test up/down arrow scroll one line
- Test page up/page down scroll one page
- Test g goes to top, G goes to bottom
- Test Esc closes viewer

**AC4 - Diff coloring:**
- Open diff content in diff mode
- Verify `+` lines have green styling
- Verify `-` lines have red styling

**AC5 - Terminal resize:**
- Open content viewer, change terminal dimensions
- Verify viewer adapts to new size

**AC6 - Esc closes viewer:**
- Open content viewer, press Esc
- Verify dialog mode returns to DialogNone

### Success Criteria
All E2E test functions pass with `go test -race`.

## Verification

- [x] All 6 acceptance criteria have corresponding test functions
- [x] All E2E tests pass with `go test -race ./internal/tui/`
- [x] Code quality checks pass (`go vet`)
- [x] No race conditions detected

## Files Modified

- `internal/tui/e2e_contentviewer_test.go` - **NEW** - E2E tests covering all 6 acceptance criteria (AC1-AC6) with 14 test cases
