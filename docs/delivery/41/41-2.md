# 41-2 Agent Indicator Rendering in Session Rows

[Back to task list](./tasks.md)

## Description

Add compact agent type/status indicators to the session list row header line. When a session has entries in the `Agents` map, render inline indicators like `[OC ●]` (active) or `[OC ○]` (idle/stopped). Sessions with an empty or nil `Agents` map show no additional indicators — zero visual overhead for single-agent sessions.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-16 07:44:29 | Created | N/A | Proposed | Task file created | AI_Agent |

## Requirements

1. Render a compact indicator for each entry in `session.Info.Agents` on the session header row
2. Agent type label mapping: `"opencode"` → `"OC"` (extensible to other agent types)
3. Status indicator: filled circle `●` for active statuses (`working`, `permission`, `waiting`), hollow circle `○` for inactive (`idle`, `stopped`, unknown)
4. Color: use existing palette — `permission` in magenta, `working` in cyan, `waiting` in yellow, inactive in gray/dim
5. Position: after the team badge (if present) or after the session name + remote label
6. No indicator shown if `Agents` map is empty or nil
7. Indicators must not push git/timestamp columns off screen — respect available width
8. Text label (`OC`) alongside icon for accessibility (don't rely on color alone)

## Implementation Plan

1. Add agent label mapping constant/function in `internal/tui/view.go` or `styles.go`:
   - `"opencode"` → `"OC"`, with a default of uppercased first 2 characters for unknown types
2. Add `renderAgentIndicators(agents map[string]session.ExternalAgent) string` in `internal/tui/view.go`
   - Iterate agents map (sorted by key for stable ordering)
   - For each: `[LABEL ICON]` where icon is `●` or `○` with appropriate color
   - Return empty string if map is nil/empty
3. Integrate into `renderSession()` (lines ~173-192 of `view.go`)
   - Insert agent indicators after the team badge, before padding/age
   - Account for indicator width in padding calculation
4. Add unit tests in `internal/tui/view_test.go`

## Test Plan

- **renderAgentIndicators**: nil map → empty string; empty map → empty string; single agent `working` → `[OC ●]` with cyan; single agent `idle` → `[OC ○]` in gray; single agent `permission` → `[OC ●]` in magenta; multiple agents → sorted by key, space-separated
- **renderSession integration**: session with no agents → row unchanged; session with agents → indicator visible in header; session with team + agents → both badge and indicator present; width edge cases
- **Existing tests**: all current session row rendering tests continue to pass

## Verification

_To be completed during implementation._

## Files Modified

_To be completed during implementation._
