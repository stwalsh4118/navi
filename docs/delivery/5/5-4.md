# [5-4] Implement dismiss functionality

[Back to task list](./tasks.md)

## Description

Implement the dismiss action that resets a session's status to `working` without attaching.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-05 00:00:00 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2026-02-05 06:03:05 | Status Change | Proposed | InProgress | Started implementation | AI_Agent |
| 2026-02-05 06:03:51 | Status Change | InProgress | Review | Implementation complete, ready for review | AI_Agent |
| 2026-02-05 06:08:24 | Status Change | Review | Done | Task completed and verified | AI_Agent |

## Requirements

1. `d` key dismisses selected session
2. Write status file with `"status": "working"`
3. Preserve other fields from current status
4. Trigger refresh after dismiss

## Implementation Plan

Implement dismiss function in `sessions.go`:
```go
func dismissSession(session SessionInfo) error {
    dir := expandPath(statusDir)
    path := filepath.Join(dir, session.TmuxSession+".json")

    // Update status to working
    session.Status = "working"
    session.Message = ""
    session.Timestamp = time.Now().Unix()

    data, err := json.MarshalIndent(session, "", "  ")
    if err != nil {
        return err
    }

    return os.WriteFile(path, data, 0644)
}
```

Handle `d` key in Update():
```go
case "d":
    if len(m.sessions) > 0 && m.cursor < len(m.sessions) {
        session := m.sessions[m.cursor]
        dismissSession(session)
        return m, func() tea.Msg { return pollSessions() }
    }
    return m, nil
```

## Test Plan

- **Objective**: Verify dismiss clears notification
- **Test Scenarios**:
  1. `d` on waiting session sets to working
  2. Message is cleared
  3. View updates immediately
  4. `d` on empty list does nothing
- **Success Criteria**: Quick acknowledgment without attach

## Verification

- [ ] `d` triggers dismiss
- [ ] Status set to "working"
- [ ] Message cleared
- [ ] JSON file updated
- [ ] View refreshes after dismiss

## Files Modified

- `sessions.go` - Added dismissSession() function, statusWorking constant
- `model.go` - Added 'd' key handler in Update()
- `model_test.go` - Added TestDismissKey tests
