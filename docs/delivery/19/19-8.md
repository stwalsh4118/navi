# [19-8] E2E CoS Test

[Back to task list](./tasks.md)

## Description

End-to-end verification of all acceptance criteria for PBI 19. This task ensures that the complete remote sessions feature works correctly across all components and meets all conditions of satisfaction.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-05 13:58:48 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2026-02-05 14:40:00 | Status Change | Proposed | InProgress | Started implementation | AI_Agent |
| 2026-02-05 14:50:00 | Status Change | InProgress | Review | Implementation complete, ready for review | AI_Agent |
| 2026-02-05 15:00:13 | Status Change | Review | Done | Task completed and verified | AI_Agent |

## Requirements

Verify all PBI 19 acceptance criteria:

1. Remote machines configurable via YAML file
2. Sessions from remotes appear in main list
3. Remote sessions labeled with host name
4. Attach to remote session opens SSH with tmux
5. Connection pooling reuses SSH connections
6. Offline remotes handled gracefully (shown as unavailable)
7. Per-remote status indicator (connected/disconnected)
8. Jump host support for bastion access
9. SSH key authentication (no password prompts)
10. Filter sessions by local/remote

## Implementation Plan

1. Create `e2e_remote_test.go` with comprehensive integration tests
2. Test configuration loading and validation
3. Test session display with remote labels
4. Test filter functionality
5. Test attach command generation (mock SSH)
6. Test error handling for offline remotes
7. Create test fixtures for remote configuration
8. Document manual testing procedures for actual SSH connections

## Test Plan

**Objective**: Full end-to-end verification of remote sessions feature.

**Test Scenarios**:

### Configuration (CoS 1)
- Valid YAML file loads correctly
- Invalid YAML produces helpful error
- Missing file results in empty remotes (no error)

### Session Display (CoS 2, 3)
- Remote sessions appear in session list
- Remote sessions show `[hostname]` label
- Local and remote sessions sort correctly together

### Remote Attach (CoS 4)
- SSH command constructed correctly
- Jump host included when configured
- Key path included in command

### Connection Pooling (CoS 5)
- Connections reused across polls
- No new connections created unnecessarily

### Error Handling (CoS 6, 7)
- Offline remotes don't crash application
- Connection status indicator shows disconnected
- Cached sessions shown as stale or hidden

### Jump Host (CoS 8)
- Jump host configuration parsed correctly
- SSH command includes -J flag

### Authentication (CoS 9)
- SSH key path used for authentication
- No password prompts in command

### Filtering (CoS 10)
- Filter by all/local/remote works
- Filter indicator visible in UI

**Success Criteria**:
- All acceptance criteria verified
- No regressions in existing functionality
- Manual SSH testing documented

## Verification

- [x] All acceptance criteria tested
- [x] E2E tests pass
- [x] No regressions in existing tests
- [x] Manual testing documented (manual SSH testing requires actual remote hosts)
- [x] Code quality checks pass
- [x] Tests pass

## Files Modified

- `e2e_remote_test.go` - Created comprehensive E2E tests for all 10 acceptance criteria
- `remote_config.go` - Added parseRemotesConfigData helper for testing

