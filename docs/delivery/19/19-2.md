# [19-2] Create SSH Manager with connection pooling

[Back to task list](./tasks.md)

## Description

Implement an SSH connection manager that handles persistent connections to remote machines. This is the core infrastructure for all remote operations, providing connection pooling, reconnection logic, and support for SSH key authentication and jump hosts (bastion servers).

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-05 13:58:48 | Created | N/A | Proposed | Task file created | AI_Agent |

## Requirements

- Create `SSHPool` struct for managing multiple SSH connections
- Support SSH key authentication (no password storage)
- Support jump host/bastion configuration
- Implement connection pooling and reuse
- Handle connection failures and reconnection
- Provide connection status per remote (connected/disconnected/error)
- Thread-safe connection management
- Configurable connection timeout and retry limits
- Clean shutdown of all connections

## Implementation Plan

1. Create new file `ssh.go` with:
   - `SSHConnection` struct for individual connections
   - `SSHPool` struct managing map of connections by remote name
   - Connection status enum (Connected, Disconnected, Error)
2. Implement connection establishment:
   - Load SSH private key from file
   - Create SSH client config with key auth
   - Handle jump host by first connecting to bastion, then tunneling
   - Set appropriate timeouts
3. Implement `SSHPool` methods:
   - `NewSSHPool(remotes []RemoteConfig)` - constructor
   - `Connect(remoteName string)` - establish/reuse connection
   - `GetStatus(remoteName string)` - return connection status
   - `Execute(remoteName string, command string)` - run command over SSH
   - `Close()` - clean shutdown of all connections
4. Add reconnection logic with exponential backoff
5. Ensure thread safety with appropriate locking

**External Packages**: This task requires research and a guide document for: `golang.org/x/crypto/ssh`

## Test Plan

**Objective**: Verify SSH pool manages connections correctly and handles errors gracefully.

**Test Scenarios**:
- Create pool with valid configuration
- Connection status tracking (mock SSH for unit tests)
- Error handling for invalid keys
- Error handling for unreachable hosts
- Thread-safe concurrent access
- Clean shutdown releases resources

**Success Criteria**:
- Unit tests pass with mocked SSH connections
- Connection status correctly tracked
- No resource leaks on shutdown

## Verification

- [ ] `SSHPool` struct defined with connection management
- [ ] SSH key authentication implemented
- [ ] Jump host support implemented
- [ ] Connection status tracking works
- [ ] Thread-safe access to connections
- [ ] Clean shutdown implemented
- [ ] Code quality checks pass
- [ ] Tests pass

## Files Modified

