# [19-4] Implement remote session polling

[Back to task list](./tasks.md)

## Description

Implement the mechanism to poll session status from remote machines via SSH and merge those sessions with local sessions. This is the core feature that aggregates sessions from multiple machines into a unified view.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-05 13:58:48 | Created | N/A | Proposed | Task file created | AI_Agent |

## Requirements

- Poll remote machines for session JSON files via SSH
- Execute `cat ~/.claude-sessions/*.json` (or configured path) on each remote
- Parse JSON output and create SessionInfo structs with Remote field set
- Merge remote sessions with local sessions in the sessions list
- Handle polling failures gracefully (show remote as unavailable)
- Parallel polling of all remotes to minimize latency
- Respect configurable sessions_dir per remote
- Update remote connection status based on poll success/failure

## Implementation Plan

1. Create `remote_sessions.go` with:
   - `pollRemoteSessions(pool *SSHPool, remotes []RemoteConfig)` function
   - Parse multi-JSON output from cat command
   - Set Remote field on each parsed session
2. Update `pollSessions()` in `sessions.go`:
   - Call `pollRemoteSessions()` if remotes configured
   - Merge remote sessions with local sessions
   - Sort combined list (existing sort logic)
3. Add new Bubble Tea message types:
   - `remoteSessionsMsg` for remote polling results
   - Include connection status per remote
4. Update `Model.Update()` to handle remote sessions message
5. Implement concurrent polling with goroutines and channels
6. Add timeout handling for slow/unresponsive remotes

## Test Plan

**Objective**: Verify remote polling fetches and merges sessions correctly.

**Test Scenarios**:
- Poll single remote with valid sessions
- Poll multiple remotes in parallel
- Handle remote with no sessions (empty result)
- Handle unreachable remote (graceful degradation)
- Handle malformed JSON from remote (skip bad entries)
- Verify Remote field is set correctly
- Verify merged list is sorted correctly

**Success Criteria**:
- Remote sessions appear in session list
- Local sessions unaffected when remotes fail
- Parallel polling completes within timeout
- Connection status updated correctly

## Verification

- [ ] Remote polling via SSH implemented
- [ ] JSON parsing handles multiple sessions
- [ ] Remote field set on all remote sessions
- [ ] Merge with local sessions works
- [ ] Parallel polling implemented
- [ ] Error handling for unreachable remotes
- [ ] Code quality checks pass
- [ ] Tests pass

## Files Modified

