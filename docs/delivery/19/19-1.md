# [19-1] Define remote configuration types and YAML parsing

[Back to task list](./tasks.md)

## Description

Create the data structures and configuration loading for remote machine definitions. This establishes the foundation for all remote session functionality by defining how users configure their remote machines and how the application loads and validates that configuration.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-05 13:58:48 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2026-02-05 14:16:32 | Status Change | Proposed | InProgress | Started implementation | AI_Agent |
| 2026-02-05 14:18:53 | Status Change | InProgress | Review | Implementation complete, ready for review | AI_Agent |
| 2026-02-05 15:00:13 | Status Change | Review | Done | Task completed and verified | AI_Agent |

## Requirements

- Define `RemoteConfig` struct matching the YAML schema in the PRD
- Support all fields: name, host, user, key, sessions_dir (with default), jump_host
- Create configuration file path constant: `~/.config/navi/remotes.yaml`
- Implement YAML file loading with proper error handling
- Validate configuration (required fields, file paths)
- Handle missing config file gracefully (empty remotes list, not an error)
- Support path expansion for SSH key paths (~ notation)

## Implementation Plan

1. Create new file `remote_config.go` with:
   - `RemoteConfig` struct with YAML tags
   - `RemotesConfig` wrapper struct for the YAML root
   - Constants for config file path and defaults
2. Implement `loadRemotesConfig()` function:
   - Expand config file path
   - Check if file exists (return empty list if not)
   - Read and parse YAML
   - Validate required fields
   - Apply defaults (sessions_dir = ~/.claude-sessions)
3. Add unit tests for configuration loading and validation

**External Packages**: This task requires research and a guide document for: `gopkg.in/yaml.v3`

## Test Plan

**Objective**: Verify configuration types compile and YAML loading works correctly.

**Test Scenarios**:
- Load valid configuration file with all fields
- Load configuration with minimal required fields (defaults applied)
- Handle missing configuration file (returns empty list)
- Handle malformed YAML (returns error)
- Validate required field checking (name, host, user, key)
- Path expansion for SSH key paths

**Success Criteria**:
- All unit tests pass
- Configuration can be loaded from example YAML

## Verification

- [ ] `RemoteConfig` struct defined with all fields
- [ ] YAML parsing works with example configuration
- [ ] Missing config file handled gracefully
- [ ] Required field validation implemented
- [ ] Path expansion works for ~ notation
- [ ] Code quality checks pass
- [ ] Tests pass

## Files Modified

- `remote_config.go` - New file with RemoteConfig types and YAML loading
- `remote_config_test.go` - Unit tests for configuration validation and parsing
- `docs/delivery/19/19-1-yaml-guide.md` - YAML v3 package guide
- `go.mod` / `go.sum` - Added gopkg.in/yaml.v3 dependency
