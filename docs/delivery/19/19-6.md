# [19-6] Implement remote session attach

[Back to task list](./tasks.md)

## Description

Implement the ability to attach to a remote tmux session by opening an SSH connection with tmux attach. This allows users to interact with Claude sessions running on remote machines directly from the navi TUI.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-05 13:58:48 | Created | N/A | Proposed | Task file created | AI_Agent |

## Requirements

- Attach to remote session via: `ssh -t user@host "tmux attach-session -t <session>"`
- Support jump host in SSH command: `ssh -J user@bastion user@host ...`
- Use configured SSH key: `ssh -i ~/.ssh/key ...`
- Hand off terminal control using `tea.ExecProcess` (like local attach)
- Return to navi TUI after detaching from remote session
- Handle connection failures gracefully with error display

## Implementation Plan

1. Update `attachSession()` in `model.go`:
   - Accept optional RemoteConfig parameter (or detect from session.Remote)
   - Build appropriate SSH command for remote sessions
   - Continue using simple tmux command for local sessions
2. Create `buildSSHAttachCommand()` helper:
   - Construct SSH command with key, jump host, and tmux attach
   - Handle all the SSH options correctly
3. Update key handler for Enter:
   - Detect if selected session is remote
   - Look up RemoteConfig by name
   - Call appropriate attach function
4. Ensure `attachDoneMsg` handler works for both local and remote

## Test Plan

**Objective**: Verify remote attach command is constructed correctly.

**Test Scenarios**:
- Local session attach unchanged
- Remote session builds correct SSH command
- Jump host included when configured
- SSH key path included
- tmux session name correctly quoted

**Success Criteria**:
- SSH command format is correct
- Terminal handoff works (manual testing)
- Return to TUI after detach works

## Verification

- [ ] Remote attach via SSH implemented
- [ ] Jump host support works
- [ ] SSH key authentication used
- [ ] Terminal handoff with tea.ExecProcess
- [ ] Return to TUI after detach
- [ ] Error handling for connection failures
- [ ] Code quality checks pass
- [ ] Tests pass

## Files Modified

