# [12-3] Add session start time tracking

[Back to task list](./tasks.md)

## Description

Implement session start time tracking by persisting the first activation timestamp. This requires modifying the hook script to preserve the start time across status updates rather than overwriting it each time.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-05 16:25:14 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2026-02-05 16:35:52 | Status Change | Proposed | InProgress | Started implementation | AI_Agent |
| 2026-02-05 16:36:42 | Status Change | InProgress | Review | Implementation complete, ready for review | AI_Agent |
| 2026-02-05 18:31:18 | Status Change | Review | Done | Task completed and verified | AI_Agent |

## Requirements

- Track when a session first becomes active (first hook call)
- Preserve start time across subsequent status updates
- Store start time in the metrics.time.started field
- Calculate total session lifetime from start time
- Handle session restarts (new start time if session was offline)

## Implementation Plan

1. Modify notify.sh hook script to:
   - Check if existing session file exists
   - If exists, read the existing metrics.time.started value
   - If not exists or started is 0, use current timestamp
   - Preserve the start time in the new JSON output
2. Add logic to handle "offline" status as a session end:
   - When session goes offline, the next "working" status starts a new session
3. Update JSON generation in notify.sh to include time metrics:
   ```bash
   # Read existing start time or use current
   if [ -f "$DIR/$SESSION.json" ]; then
     STARTED=$(jq -r '.metrics.time.started // 0' "$DIR/$SESSION.json")
   fi
   if [ "$STARTED" = "0" ] || [ "$STARTED" = "null" ] || [ -z "$STARTED" ]; then
     STARTED=$(date +%s)
   fi
   ```

## Test Plan

**Medium complexity - test time persistence:**

- Verify start time is set on first hook call
- Verify start time is preserved across multiple status updates
- Verify start time resets after offline status
- Test jq parsing handles missing fields gracefully

## Verification

- [ ] notify.sh reads existing session file for start time
- [ ] Start time is preserved across status transitions
- [ ] Start time resets when session goes offline then active
- [ ] JSON output includes metrics.time.started
- [ ] Code quality checks pass
- [ ] Manual testing confirms behavior

## Files Modified

- `hooks/notify.sh` - Added session start time tracking with preservation across status updates
