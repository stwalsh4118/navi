# [12-6] Implement status time accumulation

[Back to task list](./tasks.md)

## Description

Track and accumulate time spent in each status category (working, waiting, permission). This enables users to see how much time Claude spent actively working versus waiting for input or permissions.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-05 16:25:14 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2026-02-05 16:39:21 | Status Change | Proposed | InProgress | Started implementation | AI_Agent |
| 2026-02-05 16:40:01 | Status Change | InProgress | Review | Implementation complete, ready for review | AI_Agent |
| 2026-02-05 18:31:18 | Status Change | Review | Done | Task completed and verified | AI_Agent |

## Requirements

- Track time spent in "working" status (working_seconds)
- Track time spent in "waiting"/"permission" statuses (waiting_seconds)
- Calculate total elapsed time from session start (total_seconds)
- Update time counters on each status transition
- Persist accumulated times in session JSON

## Implementation Plan

1. Modify notify.sh to track status transitions:
   - Read previous status and timestamp from existing file
   - Calculate elapsed time since last update
   - Add elapsed time to appropriate counter based on previous status
2. Add status-specific time accumulation:
   ```bash
   # Read previous state
   PREV_STATUS=$(jq -r '.status // ""' "$DIR/$SESSION.json" 2>/dev/null)
   PREV_TIMESTAMP=$(jq -r '.timestamp // 0' "$DIR/$SESSION.json" 2>/dev/null)
   CURRENT_TIME=$(date +%s)

   # Calculate elapsed since last update
   if [ "$PREV_TIMESTAMP" != "0" ] && [ "$PREV_TIMESTAMP" != "null" ]; then
     ELAPSED=$((CURRENT_TIME - PREV_TIMESTAMP))

     # Add to appropriate counter based on PREVIOUS status
     case "$PREV_STATUS" in
       working) WORKING_SECONDS=$((WORKING_SECONDS + ELAPSED)) ;;
       waiting|permission) WAITING_SECONDS=$((WAITING_SECONDS + ELAPSED)) ;;
     esac
   fi
   ```
3. Calculate total_seconds as current_time - started
4. Update TimeMetrics in JSON output

## Test Plan

**Medium complexity - test time accumulation:**

- Verify working time accumulates during working status
- Verify waiting time accumulates during waiting/permission
- Verify total_seconds matches elapsed time from start
- Test rapid status transitions don't lose time

## Verification

- [ ] Working seconds accumulate correctly
- [ ] Waiting seconds accumulate correctly
- [ ] Total seconds calculated from start time
- [ ] Time persists across hook calls
- [ ] Code quality checks pass
- [ ] Manual testing confirms accuracy

## Files Modified

- `hooks/notify.sh` - Added status time accumulation based on previous status
