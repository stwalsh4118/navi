# [12-1] Define Metrics types and constants

[Back to task list](./tasks.md)

## Description

Add the foundational type definitions for session metrics including TokenMetrics, TimeMetrics, ToolMetrics, and the parent Metrics struct. These types will match the extended JSON format specified in the PRD and enable parsing of metrics data from session files.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-05 16:25:14 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2026-02-05 16:32:28 | Status Change | Proposed | InProgress | Started implementation | AI_Agent |
| 2026-02-05 16:33:25 | Status Change | InProgress | Review | Implementation complete, ready for review | AI_Agent |
| 2026-02-05 18:31:18 | Status Change | Review | Done | Task completed and verified | AI_Agent |

## Requirements

- Define `TokenMetrics` struct with Input, Output, and Total fields (int64)
- Define `TimeMetrics` struct with Started, TotalSeconds, WorkingSeconds, WaitingSeconds fields
- Define `ToolMetrics` struct with Recent ([]string) and Counts (map[string]int) fields
- Define `Metrics` struct containing Tokens, Time, and Tools sub-structs
- Add JSON tags for all fields matching the PRD spec
- Add constants for any default values or thresholds

## Implementation Plan

1. Create new file `metrics.go` for metrics-related types and functions
2. Define TokenMetrics struct with json tags:
   ```go
   type TokenMetrics struct {
       Input  int64 `json:"input"`
       Output int64 `json:"output"`
       Total  int64 `json:"total"`
   }
   ```
3. Define TimeMetrics struct with json tags:
   ```go
   type TimeMetrics struct {
       Started        int64 `json:"started"`
       TotalSeconds   int64 `json:"total_seconds"`
       WorkingSeconds int64 `json:"working_seconds"`
       WaitingSeconds int64 `json:"waiting_seconds"`
   }
   ```
4. Define ToolMetrics struct with json tags:
   ```go
   type ToolMetrics struct {
       Recent []string       `json:"recent"`
       Counts map[string]int `json:"counts"`
   }
   ```
5. Define parent Metrics struct:
   ```go
   type Metrics struct {
       Tokens *TokenMetrics `json:"tokens,omitempty"`
       Time   *TimeMetrics  `json:"time,omitempty"`
       Tools  *ToolMetrics  `json:"tools,omitempty"`
   }
   ```
6. Add constants for metrics display (e.g., max recent tools to track)

## Test Plan

**Simple task - focus on compilation and JSON marshaling:**

- Verify all types compile without errors
- Test JSON marshaling/unmarshaling produces expected output
- Test omitempty behavior for nil sub-structs

## Verification

- [ ] `metrics.go` file created with all type definitions
- [ ] All structs have correct JSON tags matching PRD spec
- [ ] Code compiles without errors
- [ ] JSON marshaling tests pass
- [ ] Code quality checks pass

## Files Modified

- `metrics.go` - Created with TokenMetrics, TimeMetrics, ToolMetrics, and Metrics structs
- `metrics_test.go` - Created with JSON marshaling/unmarshaling tests
