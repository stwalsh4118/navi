# [12-9] Add aggregate metrics dashboard

[Back to task list](./tasks.md)

## Description

Display aggregate metrics across all active sessions. This could be shown in the header area or as a dedicated dashboard view accessible via a keybinding. Shows total tokens, total time, and combined tool breakdown.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-05 16:25:14 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2026-02-05 16:43:17 | Status Change | Proposed | InProgress | Started implementation | AI_Agent |
| 2026-02-05 17:15:00 | Status Change | InProgress | Review | Implementation complete, ready for review | AI_Agent |
| 2026-02-05 18:31:18 | Status Change | Review | Done | Task completed and verified | AI_Agent |

## Requirements

- Calculate aggregate token totals across all sessions
- Calculate aggregate time totals across all sessions
- Aggregate tool counts across all sessions
- Display summary in header or dedicated view
- Update aggregates when sessions change

## Implementation Plan

1. Add aggregate calculation functions in metrics.go:
   ```go
   // AggregateMetrics calculates combined metrics across sessions
   func AggregateMetrics(sessions []SessionInfo) *Metrics
   ```
2. Option A - Header integration:
   - Modify renderHeader() to show aggregate stats
   - Display: "Total: 57k tokens  12h active  45 tool calls"
   - Keep compact to fit header width
3. Option B - Dedicated dashboard (if header too crowded):
   - Add 'D' keybinding for dashboard view
   - Create DialogMetricsDashboard mode
   - Show full breakdown in dialog format
4. Implement chosen approach:
   - Aggregate tokens: sum of all session totals
   - Aggregate time: sum of working + waiting across sessions
   - Aggregate tools: merged counts from all sessions
5. Handle sessions without metrics in aggregation

## Test Plan

**Medium complexity - test aggregation:**

- Test aggregation with multiple sessions
- Test aggregation with sessions without metrics
- Test aggregation with empty session list
- Verify display updates when sessions change

## Implementation Notes

- Chose Option A (header integration) for simplicity and visibility
- Token aggregation NOT implemented - token tracking not available via hooks (see task 12-4)
- Header shows aggregate time (‚è±) and tool count (üîß) for all sessions
- AggregateMetrics function returns nil if no sessions have metrics data

## Verification

- [x] Aggregate calculation function implemented
- [x] Aggregate display visible (header or dashboard)
- [N/A] Tokens sum correctly - token tracking not available
- [x] Time sums correctly
- [x] Tool counts merge correctly
- [x] Handles sessions without metrics
- [x] Code quality checks pass
- [x] Tests pass

## Files Modified

- `metrics.go` - Added AggregateMetrics function
- `view.go` - Updated renderHeader to show aggregate stats

