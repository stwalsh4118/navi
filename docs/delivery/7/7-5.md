# [7-5] Implement rename session

[Back to task list](./tasks.md)

## Description

Implement the rename session feature. When the user presses `R` on a selected session, show a text input dialog pre-filled with the current session name. On submit, execute `tmux rename-session -t <old> <new>` and rename the corresponding status JSON file to match. Preserve cursor position after rename.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-05 08:03:20 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2026-02-05 08:16:11 | Status Change | Proposed | InProgress | Started implementation | AI_Agent |
| 2026-02-05 08:45:00 | Status Change | InProgress | Review | Implementation complete, all tests pass | AI_Agent |
| 2026-02-05 09:20:33 | Status Change | Review | Done | Task completed and verified | AI_Agent |

## Requirements

- Press `R` (capital R) on selected session opens rename dialog
- Text input pre-filled with current session name
- Enter key submits the new name
- On submit:
  - Validate new session name
  - Execute `tmux rename-session -t <old> <new>`
  - Rename status JSON file from `<old>.json` to `<new>.json`
  - Close dialog on success
  - Show error message on failure
- After successful rename, cursor should stay on the renamed session
- Update footer help text to include `R rename`

## Implementation Plan

1. Add `sessionToRename` field to Model to track which session is being renamed
2. Add `R` key handler in `Update()`:
   - Check `dialogMode == DialogNone` and sessions exist
   - Set `sessionToRename` to currently selected session
   - Set `dialogMode = DialogRename`
   - Initialize name input with current session name
   - Select all text for easy replacement
3. Create `renameSessionCmd(oldName, newName string) tea.Cmd`:
   - Run `tmux rename-session -t <oldName> <newName>`
   - Rename `~/.claude-sessions/<oldName>.json` to `<newName>.json`
   - Return success/error message with new name
4. Add message type `renameSessionResultMsg` with error and newName fields
5. Handle Enter key in rename dialog:
   - Get new name from text input
   - Validate (not empty, valid chars, no conflicts)
   - If same as old name, just close dialog
   - If invalid, set `dialogError`
   - If valid, dispatch `renameSessionCmd`
6. Handle `renameSessionResultMsg`:
   - On error: set `dialogError`, stay in dialog
   - On success: close dialog, set `lastSelectedSession` to new name, trigger poll
7. Update `renderDialog()` for rename dialog:
   - Title: "Rename Session"
   - Current name displayed (read-only reference)
   - Text input for new name
   - Help text: "Enter: rename  Esc: cancel"
8. Update footer constant to include `R rename`

## Test Plan

**Objective**: Verify rename session flow preserves session identity.

**Test Scenarios**:
- Pressing `R` with session selected opens rename dialog
- Pressing `R` with no sessions does nothing
- Text input shows current session name
- Enter with same name closes dialog (no-op)
- Enter with empty name shows validation error
- Enter with invalid name shows validation error
- Enter with duplicate name shows validation error
- Enter with valid new name triggers rename command
- Rename command failure shows error in dialog
- Rename command success closes dialog
- Status JSON file renamed correctly
- Cursor stays on renamed session after refresh
- Footer shows `R rename` keybinding

**Success Criteria**:
- Rename dialog shows current name
- Validation prevents invalid new names
- tmux rename-session executes correctly
- Status file renamed correctly
- Cursor preservation works via `lastSelectedSession`

## Verification

- [x] `R` key opens rename dialog
- [x] Text input pre-filled with current name
- [x] Validation rejects invalid names
- [x] Valid submission renames tmux session
- [x] Status JSON file renamed
- [x] Cursor stays on renamed session
- [x] Error messages display on failure
- [x] Footer updated with `R rename`
- [x] Code quality checks pass
- [x] Tests pass

## Files Modified

- `model.go` - Added renameSessionResultMsg type, 'R' key handler, submitRename() function
- `sessions.go` - Added renameSessionCmd() function
- `view.go` - Updated renderDialog() for DialogRename, updated footer to include "R rename"
- `dialog.go` - DialogRename constant already added in task 7-1
- `dialog_test.go` - Added tests for rename dialog functionality
- `docs/delivery/7/7-5.md` - This task file

