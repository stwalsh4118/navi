# [7-1] Add dialog infrastructure and state management

[Back to task list](./tasks.md)

## Description

Add the foundational infrastructure for modal dialogs to the navi TUI. This includes extending the Model with dialog-related state fields, creating message types for dialog lifecycle events, implementing focus management between the main session list and dialog overlays, and adding basic dialog rendering in the View.

This task establishes the patterns that will be used by subsequent tasks for new session, kill, and rename dialogs.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-05 08:03:20 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2026-02-05 08:08:11 | Status Change | Proposed | InProgress | Started implementation | AI_Agent |
| 2026-02-05 08:09:37 | Status Change | InProgress | Review | Implementation complete, ready for review | AI_Agent |
| 2026-02-05 09:20:33 | Status Change | Review | Done | Task completed and verified | AI_Agent |

## Requirements

- Add `dialogMode` field to Model to track if a dialog is open and which type
- Add `dialogError` field to Model for displaying error messages in dialogs
- Create dialog type constants (e.g., `DialogNone`, `DialogNewSession`, `DialogKillConfirm`, `DialogRename`)
- Add message types for dialog open, close, submit, and cancel events
- Implement Escape key handling to close any open dialog
- Update View to render a dialog overlay when `dialogMode` is set
- Ensure main list keybindings are disabled when dialog is open
- Dialog should be centered and have a distinct visual style (box with border)

## Implementation Plan

1. Define dialog type constants in a new `dialog.go` file or in `model.go`
2. Extend Model struct with dialog state fields:
   - `dialogMode` - which dialog is open (or none)
   - `dialogError` - error message to display in dialog
3. Create message types:
   - `dialogOpenMsg` - contains dialog type to open
   - `dialogCloseMsg` - signal to close dialog
4. Update `Update()` to:
   - Check `dialogMode` before processing main list keybindings
   - Handle Escape key to close dialogs
   - Route dialog-specific keys when in dialog mode
5. Create `renderDialog()` helper function in `view.go`:
   - Render centered box with title based on dialog type
   - Show error message if present
   - Placeholder content (actual dialog content added in later tasks)
6. Update `View()` to call `renderDialog()` when `dialogMode != DialogNone`
7. Add dialog box style to `styles.go`

## Test Plan

**Objective**: Verify dialog infrastructure correctly manages state transitions and focus.

**Test Scenarios**:
- Model initializes with `dialogMode = DialogNone`
- Setting `dialogMode` to a dialog type prevents main list keybindings from executing
- Escape key resets `dialogMode` to `DialogNone`
- Dialog overlay renders when `dialogMode` is set
- Dialog error message displays correctly when set

**Success Criteria**:
- All existing tests continue to pass
- New dialog state tests pass
- Navigation keys (j/k) don't work when dialog is open

## Verification

- [ ] Model has `dialogMode` and `dialogError` fields
- [ ] Dialog type constants defined
- [ ] Escape key closes any open dialog
- [ ] Main keybindings disabled when dialog open
- [ ] Dialog renders as centered overlay
- [ ] Code quality checks pass
- [ ] Tests pass

## Files Modified

- `dialog.go` - New file with DialogMode type and constants
- `model.go` - Extended Model struct with dialogMode and dialogError fields; added updateDialog() and closeDialog() functions
- `styles.go` - Added dialog styles (dialogBoxStyle, dialogTitleStyle, dialogErrorStyle)
- `view.go` - Added renderDialog() function
- `dialog_test.go` - New file with tests for dialog infrastructure
