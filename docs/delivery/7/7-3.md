# [7-3] Implement new session creation

[Back to task list](./tasks.md)

## Description

Implement the full new session creation feature. When the user presses `n`, open a dialog with inputs for session name and working directory. On submit, execute `tmux new-session -d -s <name> -c <dir> "claude"` to create the session. The new session will appear in the list after the next poll cycle.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-05 08:03:20 | Created | N/A | Proposed | Task file created | AI_Agent |

## Requirements

- Press `n` opens new session dialog (only when no dialog is open)
- Dialog contains two inputs:
  - Session name (default: auto-generated based on timestamp or directory name)
  - Working directory (default: current working directory)
- Tab key switches focus between inputs
- Enter key submits the dialog
- On submit:
  - Validate session name
  - Execute `tmux new-session -d -s <name> -c <dir> "claude"`
  - Close dialog on success
  - Show error message in dialog on failure
- New session appears in list after next poll (500ms)
- Update footer help text to include `n new`

## Implementation Plan

1. Add `n` key handler in `Update()`:
   - Check `dialogMode == DialogNone`
   - Set `dialogMode = DialogNewSession`
   - Initialize text inputs with defaults
   - Focus name input
2. Create `createSessionCmd(name, dir string) tea.Cmd`:
   - Run `tmux new-session -d -s <name> -c <dir> "claude"`
   - Return success/error message
3. Add message type `createSessionResultMsg` with error field
4. Handle Tab key in dialog mode to switch focus between inputs
5. Handle Enter key in new session dialog:
   - Get values from text inputs
   - Validate session name
   - If invalid, set `dialogError` and stay in dialog
   - If valid, dispatch `createSessionCmd`
6. Handle `createSessionResultMsg`:
   - On error: set `dialogError`, stay in dialog
   - On success: close dialog, trigger poll refresh
7. Update `renderDialog()` to render new session dialog content:
   - Title: "New Session"
   - Name input with label
   - Directory input with label
   - Error message if present
   - Help text: "Tab: switch field  Enter: create  Esc: cancel"
8. Update footer constant to include `n new`

## Test Plan

**Objective**: Verify new session creation flow end-to-end.

**Test Scenarios**:
- Pressing `n` when no dialog open sets `dialogMode = DialogNewSession`
- Pressing `n` when dialog open does nothing
- Tab key switches focus between name and directory inputs
- Enter with empty name shows validation error
- Enter with invalid name shows validation error
- Enter with valid name triggers create command
- Create command failure shows error in dialog
- Create command success closes dialog
- Footer shows new `n` keybinding

**Success Criteria**:
- New session dialog opens and closes correctly
- Input navigation works with Tab
- Validation prevents invalid session names
- tmux command executes with correct arguments
- Error handling displays messages appropriately

## Verification

- [ ] `n` key opens new session dialog
- [ ] Dialog has name and directory inputs
- [ ] Tab switches between inputs
- [ ] Validation rejects invalid names
- [ ] Valid submission creates tmux session
- [ ] Error messages display in dialog
- [ ] Success closes dialog
- [ ] Footer updated with `n new`
- [ ] Code quality checks pass
- [ ] Tests pass

## Files Modified

