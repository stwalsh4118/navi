# [7-6] E2E CoS Test

[Back to task list](./tasks.md)

## Description

End-to-end verification that all PBI-7 acceptance criteria are met. This task provides comprehensive integration testing of the create, kill, and rename session features working together, including error handling and edge cases.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-05 08:03:20 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2026-02-05 08:46:00 | Status Change | Proposed | InProgress | Started E2E CoS testing | AI_Agent |
| 2026-02-05 08:55:00 | Status Change | InProgress | Review | All E2E tests pass, comprehensive coverage achieved | AI_Agent |
| 2026-02-05 09:20:33 | Status Change | Review | Done | Task completed and verified | AI_Agent |

## Requirements

Verify all acceptance criteria from PBI-7:

1. Pressing `n` opens new session dialog with name and directory inputs
2. New sessions are created in tmux and appear in the list
3. Pressing `x` prompts for confirmation before killing a session
4. Killed sessions are removed from tmux and status files are cleaned up
5. Pressing `R` allows renaming with validation for valid tmux session names
6. All operations show appropriate error messages on failure
7. Footer keybindings are updated to show new actions

## Implementation Plan

1. Create comprehensive integration test file `model_session_actions_test.go`
2. Test new session creation:
   - Dialog opens with correct state
   - Inputs accept and validate user input
   - tmux command constructed correctly
   - Success path creates session
   - Error path shows message
3. Test kill session:
   - Confirmation dialog shows correct session name
   - `y` executes kill
   - `n` cancels
   - Status file deleted on success
   - Error handling works
4. Test rename session:
   - Dialog pre-filled with current name
   - Validation works for all invalid cases
   - tmux rename command constructed correctly
   - Status file renamed on success
   - Cursor preservation after rename
5. Test error scenarios:
   - tmux not available
   - Permission errors
   - Invalid session names
   - Duplicate session names
6. Test dialog interactions:
   - Escape closes any dialog
   - Tab navigation in multi-input dialogs
   - Keyboard focus management
7. Verify footer help text includes all new keybindings

## Test Plan

**Objective**: Comprehensive verification of all PBI-7 acceptance criteria.

### AC1: New Session Dialog
- [x] `n` key opens dialog when no dialog is open
- [x] Dialog has name input field
- [x] Dialog has directory input field
- [x] Tab switches between fields
- [x] Escape cancels dialog
- [x] Enter submits dialog

### AC2: New Sessions Created
- [x] Valid name/dir creates tmux session with correct command
- [x] Session appears in list after poll
- [x] Default name is reasonable (not empty)
- [x] Default directory is reasonable (cwd or home)

### AC3: Kill Confirmation
- [x] `x` key shows confirmation dialog
- [x] Dialog shows session name being killed
- [x] `y` confirms action
- [x] `n` cancels action
- [x] Escape cancels action

### AC4: Kill Cleanup
- [x] tmux kill-session executed with correct session name
- [x] Status JSON file deleted from ~/.claude-sessions/
- [x] Session removed from list after poll

### AC5: Rename Validation
- [x] `R` key opens rename dialog
- [x] Input pre-filled with current name
- [x] Empty name rejected
- [x] Name with `.` rejected
- [x] Name with `:` rejected
- [x] Duplicate name rejected
- [x] Valid name accepted

### AC6: Error Messages
- [x] Create failure shows error in dialog
- [x] Kill failure shows error in dialog
- [x] Rename failure shows error in dialog
- [x] Validation errors shown inline

### AC7: Footer Updates
- [x] Footer shows `n new`
- [x] Footer shows `x kill`
- [x] Footer shows `R rename`

**Success Criteria**:
- All acceptance criteria verified with passing tests
- No regressions in existing functionality
- Error handling covers all expected failure modes

## Verification

- [x] All acceptance criteria have corresponding tests
- [x] Tests cover success and error paths
- [x] Tests cover edge cases (empty list, dialog interactions)
- [x] Existing tests still pass
- [x] Manual testing confirms all features work as expected
- [x] Code quality checks pass
- [x] Test coverage adequate for new code

## Files Modified

- `e2e_session_actions_test.go` - New comprehensive E2E test file covering all PBI-7 acceptance criteria
- `dialog_test.go` - Added rename session tests
- `docs/delivery/7/7-6.md` - This task file

