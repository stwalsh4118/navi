# [7-6] E2E CoS Test

[Back to task list](./tasks.md)

## Description

End-to-end verification that all PBI-7 acceptance criteria are met. This task provides comprehensive integration testing of the create, kill, and rename session features working together, including error handling and edge cases.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-05 08:03:20 | Created | N/A | Proposed | Task file created | AI_Agent |

## Requirements

Verify all acceptance criteria from PBI-7:

1. Pressing `n` opens new session dialog with name and directory inputs
2. New sessions are created in tmux and appear in the list
3. Pressing `x` prompts for confirmation before killing a session
4. Killed sessions are removed from tmux and status files are cleaned up
5. Pressing `R` allows renaming with validation for valid tmux session names
6. All operations show appropriate error messages on failure
7. Footer keybindings are updated to show new actions

## Implementation Plan

1. Create comprehensive integration test file `model_session_actions_test.go`
2. Test new session creation:
   - Dialog opens with correct state
   - Inputs accept and validate user input
   - tmux command constructed correctly
   - Success path creates session
   - Error path shows message
3. Test kill session:
   - Confirmation dialog shows correct session name
   - `y` executes kill
   - `n` cancels
   - Status file deleted on success
   - Error handling works
4. Test rename session:
   - Dialog pre-filled with current name
   - Validation works for all invalid cases
   - tmux rename command constructed correctly
   - Status file renamed on success
   - Cursor preservation after rename
5. Test error scenarios:
   - tmux not available
   - Permission errors
   - Invalid session names
   - Duplicate session names
6. Test dialog interactions:
   - Escape closes any dialog
   - Tab navigation in multi-input dialogs
   - Keyboard focus management
7. Verify footer help text includes all new keybindings

## Test Plan

**Objective**: Comprehensive verification of all PBI-7 acceptance criteria.

### AC1: New Session Dialog
- [ ] `n` key opens dialog when no dialog is open
- [ ] Dialog has name input field
- [ ] Dialog has directory input field
- [ ] Tab switches between fields
- [ ] Escape cancels dialog
- [ ] Enter submits dialog

### AC2: New Sessions Created
- [ ] Valid name/dir creates tmux session with correct command
- [ ] Session appears in list after poll
- [ ] Default name is reasonable (not empty)
- [ ] Default directory is reasonable (cwd or home)

### AC3: Kill Confirmation
- [ ] `x` key shows confirmation dialog
- [ ] Dialog shows session name being killed
- [ ] `y` confirms action
- [ ] `n` cancels action
- [ ] Escape cancels action

### AC4: Kill Cleanup
- [ ] tmux kill-session executed with correct session name
- [ ] Status JSON file deleted from ~/.claude-sessions/
- [ ] Session removed from list after poll

### AC5: Rename Validation
- [ ] `R` key opens rename dialog
- [ ] Input pre-filled with current name
- [ ] Empty name rejected
- [ ] Name with `.` rejected
- [ ] Name with `:` rejected
- [ ] Duplicate name rejected
- [ ] Valid name accepted

### AC6: Error Messages
- [ ] Create failure shows error in dialog
- [ ] Kill failure shows error in dialog
- [ ] Rename failure shows error in dialog
- [ ] Validation errors shown inline

### AC7: Footer Updates
- [ ] Footer shows `n new`
- [ ] Footer shows `x kill`
- [ ] Footer shows `R rename`

**Success Criteria**:
- All acceptance criteria verified with passing tests
- No regressions in existing functionality
- Error handling covers all expected failure modes

## Verification

- [ ] All acceptance criteria have corresponding tests
- [ ] Tests cover success and error paths
- [ ] Tests cover edge cases (empty list, dialog interactions)
- [ ] Existing tests still pass
- [ ] Manual testing confirms all features work as expected
- [ ] Code quality checks pass
- [ ] Test coverage adequate for new code

## Files Modified

