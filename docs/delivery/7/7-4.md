# [7-4] Implement kill session with confirmation

[Back to task list](./tasks.md)

## Description

Implement the kill session feature with a confirmation dialog. When the user presses `x` on a selected session, show a confirmation prompt. On confirmation, execute `tmux kill-session -t <name>` and delete the corresponding status JSON file. Handle edge cases like trying to kill an attached session.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-05 08:03:20 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2026-02-05 08:14:21 | Status Change | Proposed | InProgress | Started implementation | AI_Agent |
| 2026-02-05 08:15:54 | Status Change | InProgress | Review | Implementation complete, ready for review | AI_Agent |
| 2026-02-05 09:20:33 | Status Change | Review | Done | Task completed and verified | AI_Agent |

## Requirements

- Press `x` on selected session opens confirmation dialog
- Confirmation dialog shows: "Kill session '<name>'? (y/n)"
- Press `y` confirms and executes kill
- Press `n` or Escape cancels and closes dialog
- On confirm:
  - Execute `tmux kill-session -t <name>`
  - Delete status JSON file from `~/.claude-sessions/`
  - Close dialog
  - Trigger poll refresh
- Show error message if kill fails
- Warn if session appears to be attached (optional enhancement)
- Update footer help text to include `x kill`

## Implementation Plan

1. Add `sessionToKill` field to Model to track which session is being killed
2. Add `x` key handler in `Update()`:
   - Check `dialogMode == DialogNone` and sessions exist
   - Set `sessionToKill` to currently selected session
   - Set `dialogMode = DialogKillConfirm`
3. Create `killSessionCmd(name string) tea.Cmd`:
   - Run `tmux kill-session -t <name>`
   - Delete `~/.claude-sessions/<name>.json`
   - Return success/error message
4. Add message type `killSessionResultMsg` with error field
5. Handle `y` key in kill confirm dialog:
   - Dispatch `killSessionCmd` with `sessionToKill.TmuxSession`
6. Handle `n` key in kill confirm dialog:
   - Close dialog (same as Escape)
7. Handle `killSessionResultMsg`:
   - On error: set `dialogError`, stay in dialog
   - On success: close dialog, clear `sessionToKill`, trigger poll
8. Update `renderDialog()` for kill confirmation:
   - Title: "Kill Session"
   - Message: "Kill session '<name>'?"
   - Help text: "y: yes  n: no  Esc: cancel"
9. Update footer constant to include `x kill`

## Test Plan

**Objective**: Verify kill session flow with confirmation.

**Test Scenarios**:
- Pressing `x` with session selected opens confirmation dialog
- Pressing `x` with no sessions does nothing
- Dialog shows correct session name
- Pressing `y` triggers kill command
- Pressing `n` closes dialog without killing
- Pressing Escape closes dialog without killing
- Kill command failure shows error in dialog
- Kill command success closes dialog and refreshes list
- Status JSON file is deleted on successful kill
- Footer shows `x kill` keybinding

**Success Criteria**:
- Confirmation prevents accidental kills
- tmux kill-session executes correctly
- Status file cleanup works
- Error handling displays messages appropriately

## Verification

- [ ] `x` key opens confirmation dialog
- [ ] Dialog shows session name being killed
- [ ] `y` confirms and executes kill
- [ ] `n` cancels without killing
- [ ] tmux kill-session command executes
- [ ] Status JSON file deleted
- [ ] Error messages display on failure
- [ ] Footer updated with `x kill`
- [ ] Code quality checks pass
- [ ] Tests pass

## Files Modified

- `model.go` - Added `x` key handler, killSessionResultMsg type, `y`/`n` key handlers in dialog mode, message handler for kill result
- `sessions.go` - Added killSessionCmd() function
- `view.go` - Updated footer help text, updated renderDialog() for kill confirmation content
- `dialog_test.go` - Added tests for kill session dialog functionality
