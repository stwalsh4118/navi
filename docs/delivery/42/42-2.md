# 42-2 Implement audio player detection and playback

[Back to task list](./tasks.md)

## Description

Implement system audio player detection and non-blocking sound file playback. The player auto-detects available system binaries and plays `.wav`/`.mp3`/`.ogg` files via `exec.Command` without blocking the TUI.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-14 08:41:13 | Created | N/A | Proposed | Task file created | AI_Agent |

## Requirements

1. `Player` type with methods:
   - `NewPlayer(override string) *Player` — creates player, auto-detects if override is "auto"
   - `Play(filePath string) error` — plays sound file non-blocking (fire-and-forget goroutine)
   - `Available() bool` — returns whether a usable player was detected
   - `Backend() string` — returns name of detected player binary
2. Auto-detection order:
   - Linux: `paplay`, `aplay`, `ffplay`, `mpv`
   - macOS: `afplay`
   - Detection via `exec.LookPath`
3. Non-blocking: `Play()` launches in a goroutine, returns immediately
4. Validate file exists before attempting playback
5. Errors logged but never propagated to caller (fire-and-forget)
6. Accept player override from config to skip auto-detection

## Implementation Plan

1. Create `internal/audio/player.go`
2. Create `internal/audio/player_test.go`
3. Use `exec.LookPath` for detection, `exec.Command` for playback
4. Player detection runs once at construction time, result cached
5. `Play()` validates file exists, spawns goroutine with `cmd.Run()`

## Test Plan

- **Detection with override**: `NewPlayer("paplay")` uses specified binary without auto-detect
- **Detection with "auto"**: Falls through detection list (mock `exec.LookPath` via interface or test helper)
- **Available()**: Returns `false` when no player found, `true` when found
- **Backend()**: Returns correct binary name
- **Play() with missing file**: Returns error for non-existent file
- **Play() non-blocking**: Verify `Play()` returns immediately (doesn't block)

## Verification

_To be completed during implementation._

## Files Modified

- `internal/audio/player.go` (new)
- `internal/audio/player_test.go` (new)
