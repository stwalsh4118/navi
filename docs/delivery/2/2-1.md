# [2-1] Create notify.sh hook script

[Back to task list](./tasks.md)

## Description

Implement the shell script that Claude Code hooks call to write status JSON files to the shared status directory.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-05 00:00:00 | Created | N/A | Proposed | Task file created | AI_Agent |

## Requirements

1. Accept status as first argument
2. Read message from `CLAUDE_NOTIFICATION` environment variable
3. Get tmux session name via `tmux display-message`
4. Get current working directory via tmux
5. Write JSON to `~/.claude-sessions/<session>.json`
6. Handle missing tmux gracefully (use "unknown" as session name)

## Implementation Plan

Implement `hooks/notify.sh`:
```bash
#!/bin/bash
STATUS="$1"
MESSAGE="${CLAUDE_NOTIFICATION:-}"
DIR="$HOME/.claude-sessions"
mkdir -p "$DIR"

SESSION=$(tmux display-message -p '#{session_name}' 2>/dev/null || echo "unknown")
CWD=$(tmux display-message -p '#{pane_current_path}' 2>/dev/null || echo "")

cat > "$DIR/$SESSION.json" <<EOF
{
  "tmux_session": "$SESSION",
  "status": "$STATUS",
  "message": "$MESSAGE",
  "cwd": "$CWD",
  "timestamp": $(date +%s)
}
EOF
```

## Test Plan

- **Objective**: Verify script writes correct JSON
- **Test Scenarios**:
  1. Run script with status argument in tmux session
  2. Verify JSON file is created with correct content
  3. Run outside tmux - should use "unknown" as session name
- **Success Criteria**: JSON file matches expected structure

## Verification

- [ ] Script accepts status argument
- [ ] Script reads CLAUDE_NOTIFICATION env var
- [ ] Script gets tmux session name
- [ ] Script gets current working directory
- [ ] Script writes valid JSON
- [ ] Script handles missing tmux gracefully

## Files Modified

- `hooks/notify.sh`
