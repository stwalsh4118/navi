# [55-1] PM Loading Indicator

[Back to task list](./tasks.md)

## Description

Display a visible loading indicator in the PM view briefing zone when `pmRunInFlight` is true. Currently, the `pmRunInFlight` flag is tracked in the model but never rendered visually — the user gets no feedback that a PM refresh is happening. This task adds a "Refreshing..." indicator following the existing pattern used in the task panel header (`taskview.go:160`).

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-18 08:00:46 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2026-02-18 08:03:58 | Status Change | Proposed | Agreed | User requested implementation of PBI-55 | User |
| 2026-02-18 08:04:40 | Status Change | Agreed | InProgress | Started implementation | AI_Agent |
| 2026-02-18 08:09:30 | Status Change | InProgress | Review | Implementation complete, internal AI review passed | AI_Agent |
| 2026-02-18 08:33:37 | Status Change | Review | Done | Task completed and verified | AI_Agent |

## Requirements

1. When `pmRunInFlight` is true, render a loading indicator in the PM briefing zone.
2. Use the same dim italic "Refreshing..." style already used in the task panel header.
3. Preserve the last successful PM output (snapshots, events) while loading — do not clear existing data.
4. The loading indicator must work in narrow terminal widths (>= 80 columns, the existing `pmMinTerminalWidth`).
5. When `pmRunInFlight` transitions to false, the indicator disappears and the briefing zone returns to its normal state.

## Implementation Plan

1. In `pmview.go`, modify `renderPMBriefing()` to check `m.pmRunInFlight`.
2. When true, render "Refreshing..." using `dimStyle.Render(italicStyle.Render("Refreshing..."))` — same as task panel.
3. Show the loading indicator alongside the existing placeholder/error content (e.g., prepend or replace the briefing placeholder text).
4. No changes to PM data flow or state management needed — this is purely a rendering change.

## Test Plan

- Unit test: verify `renderPMBriefing` output contains "Refreshing" when `pmRunInFlight` is true.
- Unit test: verify `renderPMBriefing` does NOT contain "Refreshing" when `pmRunInFlight` is false.
- Verify existing PM view tests still pass.

## Verification

- Added PM briefing loading indicator in `renderPMBriefing` using shared `pmRefreshingLabel` and dim italic style while `pmRunInFlight` is true.
- Preserved existing placeholder/error behavior and added single-line fallback that prioritizes the loading indicator when height is constrained.
- Added unit coverage for loading visible/hidden states, single-line rendering, loading+error combination, and full PM view composition.
- Executed: `go test ./internal/tui -run 'TestPMView|TestPMBriefingLoadingIndicator'` (pass).
- Internal AI review gate verdict: pass (no critical/high/medium/low findings in final review).

## Files Modified

- `internal/tui/pmview.go`
- `internal/tui/pmview_test.go`
- `docs/delivery/55/tasks.md`
- `docs/delivery/55/55-1.md`
