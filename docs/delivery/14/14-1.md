# [14-1] Add selection state to Model and toggle keybindings

[Back to task list](./tasks.md)

## Description

Add multi-selection state tracking to the Model struct and implement the core keybindings for toggling selection. This is the foundational task that all other multi-session operation tasks depend on.

Adds:
- `selected map[string]bool` field to Model (keyed by session name)
- `Space` key to toggle selection on the current session
- `a` key to select all visible (filtered) sessions
- `A` key to deselect all sessions
- Selection count display in the footer (e.g., "3 selected")
- Selection persistence across cursor movement and session list refreshes
- Cleanup of stale selections when sessions are removed

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-05 19:04:22 | Created | N/A | Proposed | Task file created | AI_Agent |

## Requirements

- Add `selected map[string]bool` to the Model struct, initialized in `initialModel()`
- `Space` toggles selection on the session under the cursor (does NOT move cursor)
- `a` selects all currently visible/filtered sessions
- `A` (Shift+a) deselects all sessions
- Selection persists across cursor movement (up/down navigation)
- Selection persists across session list refreshes (polling)
- Stale selections (sessions that no longer exist) are cleaned up on each poll
- Selection count shown in footer when > 0 (e.g., "3 selected")
- Selection works correctly with filter modes (All/Local/Remote)
- Remote sessions can be selected (though some bulk actions may not apply to them)

## Implementation Plan

1. Add `selected map[string]bool` field to Model struct in `model.go`
2. Initialize `selected: make(map[string]bool)` in `initialModel()`
3. Add helper methods:
   - `getSelectedSessions() []SessionInfo` - returns all selected sessions
   - `getSelectedOrCurrent() []SessionInfo` - returns selected sessions, or just the cursor session if none selected
   - `cleanStaleSelections()` - removes entries for sessions no longer in the list
4. Handle `Space` key in Update: toggle `m.selected[session.TmuxSession]`
5. Handle `a` key in Update: select all filtered sessions
6. Handle `A` key in Update: clear the entire selected map
7. Call `cleanStaleSelections()` when processing `sessionsMsg` and `remoteSessionsMsg`
8. Update `renderFooter()` to include selection count when > 0
9. Note: `a` key currently has no binding; `A` (shift+a) has no binding; `Space` has no binding outside dialogs

## Test Plan

- Verify `Space` toggles selection on current session
- Verify `Space` on already-selected session deselects it
- Verify `a` selects all visible sessions
- Verify `A` deselects all sessions
- Verify selection count in footer updates correctly
- Verify selection persists across cursor movement
- Verify stale selections are cleaned up when sessions disappear
- Verify selection works with filter modes
- Verify `getSelectedOrCurrent()` returns cursor session when none selected
- Verify `getSelectedOrCurrent()` returns all selected when selections exist

## Verification

- [ ] `selected` map added to Model and initialized
- [ ] `Space` toggles selection
- [ ] `a` selects all visible sessions
- [ ] `A` deselects all
- [ ] Footer shows selection count
- [ ] Stale selections cleaned on poll
- [ ] Code quality checks pass
- [ ] Tests pass

## Files Modified

