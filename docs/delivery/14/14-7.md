# [14-7] Implement broadcast input mode

[Back to task list](./tasks.md)

## Description

Add a broadcast mode that allows the user to type input and send it to all selected sessions simultaneously via tmux `send-keys`. This is a powerful feature that requires prominent warnings due to its potential to affect multiple sessions at once.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-05 19:04:22 | Created | N/A | Proposed | Task file created | AI_Agent |

## Requirements

- `B` (Shift+b) enters broadcast mode when sessions are selected
- Broadcast mode shows a text input with a prominent warning banner
- The warning clearly states: input will be sent to N sessions
- User types input text
- `Enter` sends the input to all selected sessions via `tmux send-keys -t <session> "<input>" Enter`
- `Esc` cancels broadcast mode without sending
- Remote sessions are excluded from broadcast
- If no sessions are selected, broadcast to just the current session (with warning)
- Input is NOT sent until Enter is pressed (no character-by-character broadcast)

## Implementation Plan

1. Add `DialogBroadcast` to the `DialogMode` enum
2. Add a broadcast text input field to Model
3. Add `B` key handler:
   - Gather selected sessions (or current), filter out remote
   - If no valid targets, show error
   - Set `dialogMode = DialogBroadcast`, focus input
4. Render broadcast dialog:
   - Warning banner in red/yellow: "⚠ BROADCAST MODE ⚠"
   - "Input will be sent to N sessions:"
   - List session names
   - Text input for the command
   - "Enter to send, Esc to cancel"
5. Handle dialog input:
   - `Enter`: for each target, execute `tmux send-keys -t <session> "<input>" Enter`
   - `Esc`: cancel and return to normal mode
6. After sending, close dialog and optionally show brief confirmation
7. Use `tea.Batch` to send all commands concurrently

## Test Plan

- Verify `B` with selections enters broadcast mode dialog
- Verify warning banner is prominently displayed
- Verify session names are listed in the dialog
- Verify `Enter` sends input to all selected sessions
- Verify `Esc` cancels without sending
- Verify remote sessions are excluded
- Verify empty input is not sent
- Verify works for single session when nothing selected
- Verify tmux send-keys command is correctly formatted

## Verification

- [ ] Broadcast dialog renders with warning
- [ ] Input sent to all selected local sessions on Enter
- [ ] Esc cancels without sending
- [ ] Remote sessions excluded
- [ ] Empty input prevented
- [ ] Code quality checks pass
- [ ] Tests pass

## Files Modified

