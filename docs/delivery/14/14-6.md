# [14-6] Implement bulk permission approval

[Back to task list](./tasks.md)

## Description

Add the ability to approve pending permissions across multiple selected sessions. When sessions in "permission" status are selected, the user can approve all their pending permissions at once with confirmation.

Note: This task depends on PBI-22 (Permission Rules) for the underlying permission approval mechanism. If PBI-22 is not yet implemented, this task will implement a basic approach using tmux `send-keys` to send approval input to permission-waiting sessions.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-05 19:04:22 | Created | N/A | Proposed | Task file created | AI_Agent |

## Requirements

- New keybinding (e.g., `y` when in normal mode) to approve permissions on selected sessions
- Only sessions in "permission" status are acted upon
- A confirmation dialog shows which sessions will have permissions approved
- On confirmation, send approval input to each permission-waiting session via tmux
- Remote sessions are excluded (cannot send input to remote sessions without SSH)
- If no sessions are selected, approve permission on the current session (if it's in permission status)

## Implementation Plan

1. Add `DialogBulkPermissionApprove` to the `DialogMode` enum
2. Add a keybinding (`y`) for bulk permission approval:
   - Gather selected sessions (or current) that have `Status == "permission"`
   - If none have permission status, do nothing (or show message)
   - If targets found, show confirmation dialog
3. Implement confirmation dialog:
   - Title: "Approve permissions on N sessions?"
   - List session names
   - `y` to confirm, `n`/`esc` to cancel
4. On confirmation, for each target session:
   - Use `tmux send-keys -t <session> "y" Enter` to approve
   - Or integrate with PBI-22 mechanism if available
5. Filter out remote sessions from targets

**Dependency Note**: Basic implementation uses tmux send-keys. If PBI-22 provides a more sophisticated mechanism, this can be updated.

## Test Plan

- Verify `y` with permission-status sessions selected shows confirmation dialog
- Verify only permission-status sessions are included
- Verify confirmation sends approval to each session
- Verify cancel does not send approval
- Verify remote sessions excluded
- Verify works for single session when nothing selected

## Verification

- [ ] Bulk permission approval dialog renders correctly
- [ ] Only permission-status sessions targeted
- [ ] Approval sent to each targeted session
- [ ] Remote sessions excluded
- [ ] Single-session approval unaffected
- [ ] Code quality checks pass
- [ ] Tests pass

## Files Modified

