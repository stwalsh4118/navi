# [14-8] E2E CoS Test

[Back to task list](./tasks.md)

## Description

End-to-end verification of all acceptance criteria for PBI 14: Multi-Session Operations. This task validates that all multi-session features work together correctly and meet the PBI's Conditions of Satisfaction.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-05 19:04:22 | Created | N/A | Proposed | Task file created | AI_Agent |

## Requirements

Verify ALL acceptance criteria from PBI 14:

1. `Space` toggles session selection
2. Multiple sessions can be selected simultaneously
3. `a` selects all visible, `A` deselects all
4. Selection count shown in footer
5. `x` kills all selected sessions (with confirmation)
6. `d` dismisses notifications on all selected
7. `t` adds tag to all selected
8. Bulk permission approval available for permission-status sessions
9. Broadcast input sends to all selected (with warning)
10. Selection persists across list updates

## Implementation Plan

1. Create comprehensive E2E test file `e2e_multiselect_test.go`
2. Test scenarios:
   - **Selection basics**: Toggle, select-all, deselect-all, persistence
   - **Selection + filtering**: Selection behavior across filter mode changes
   - **Bulk kill**: Confirmation dialog, execution, cleanup
   - **Bulk dismiss**: Multi-session dismiss, remote exclusion
   - **Bulk tag**: Tag dialog, tag application
   - **Bulk permission approval**: Permission filtering, approval execution
   - **Broadcast mode**: Warning display, input sending, cancellation
   - **Edge cases**: Empty selection, all-remote selection, single session fallback
3. Verify all acceptance criteria pass

## Test Plan

### Objective
Validate all PBI 14 acceptance criteria are met through end-to-end testing.

### Test Scenarios

**Selection Mechanics:**
- Toggle selection on/off with Space
- Select all with `a`, deselect all with `A`
- Selection persists across cursor movement
- Selection persists across session list refresh (polling)
- Selection count in footer updates correctly
- Stale selections cleaned when sessions disappear

**Bulk Actions:**
- Kill: confirmation dialog, execution, error handling
- Dismiss: multi-session dismiss, no confirmation needed
- Tag: tag input dialog, tag application
- Permission: only targets permission-status sessions
- Broadcast: warning banner, input capture, tmux send-keys

**Edge Cases:**
- No sessions selected: falls back to single session
- All selected sessions are remote: appropriate behavior per action
- Mixed local/remote selection: remote sessions excluded from local-only actions
- Selection during filter mode change

### Success Criteria
- All 10 acceptance criteria from PBI 14 pass
- No regressions in existing single-session actions
- All tests pass with `go test -race ./...`

## Verification

- [ ] All acceptance criteria verified
- [ ] No regressions in existing functionality
- [ ] All tests pass with race detector
- [ ] Code quality checks pass

## Files Modified

