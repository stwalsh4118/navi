# [38-4] Enhance Session List PR Indicator

[Back to task list](./tasks.md)

## Description

Update the inline PR indicator shown in the session list row to convey more at-a-glance PR context. Currently it shows `[PR#42]`. This task enhances it to show aggregate check status, comment count, and draft state using compact indicators that fit within the session row width.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-12 09:18:16 | Created | N/A | Proposed | Task file created | AI_Agent |

## Requirements

- Update `FormatStatusLine()` in `internal/git/git.go` to use `PRDetail` data when available
- Show aggregate check indicator after PR number:
  - `[PR#42 ‚úì]` ‚Äî All checks passed
  - `[PR#42 ‚úó]` ‚Äî Any check failed
  - `[PR#42 ‚óè]` ‚Äî Checks pending or in progress
  - `[PR#42]` ‚Äî No checks configured (current behavior)
- Show comment count when > 0: `[PR#42 ‚úì üí¨5]`
- Show draft indicator: `[PR#42 draft]`
- When draft, omit check indicator (draft PRs often don't have meaningful checks yet)
- Ensure the indicator respects `maxWidth` truncation
- Fall back to `[PR#42]` when `PRDetail` is nil (backward compatibility)
- Use constants for all indicator strings

## Implementation Plan

1. Update `FormatStatusLine()` in `internal/git/git.go` to accept or read `PRDetail` from `Info`
2. Build the PR indicator string based on available `PRDetail` data:
   - Start with `PR#<number>`
   - Append check indicator if checks exist and not draft
   - Append comment count if > 0
   - Replace all with `draft` if PR is a draft
   - Wrap in brackets
3. Define display constants for new indicators (comment icon, etc.)
4. Ensure total line width respects `maxWidth` parameter
5. Update any callers of `FormatStatusLine` if signature changes

## Test Plan

- Test indicator with all checks passing: `[PR#42 ‚úì]`
- Test indicator with failing checks: `[PR#42 ‚úó]`
- Test indicator with pending checks: `[PR#42 ‚óè]`
- Test indicator with no checks: `[PR#42]`
- Test indicator with comments: `[PR#42 ‚úì üí¨5]`
- Test indicator for draft PR: `[PR#42 draft]`
- Test indicator with nil PRDetail (backward compat): `[PR#42]`
- Test maxWidth truncation with long branch + full indicator
- Verify existing `FormatStatusLine` tests still pass

## Verification

- [ ] Enhanced indicators render correctly for all states
- [ ] Backward compatible when PRDetail is nil
- [ ] Width truncation works correctly
- [ ] Existing tests pass
- [ ] Code quality checks pass
- [ ] Tests pass

## Files Modified

<To be filled during implementation>
