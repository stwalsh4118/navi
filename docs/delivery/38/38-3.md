# [38-3] Enhance Git Detail View with PR Metadata

[Back to task list](./tasks.md)

## Description

Extend the existing git detail dialog to display the full set of PR metadata when available. Currently the dialog shows PR number and a link. This task adds: title, state (open/closed/merged), draft indicator, mergeable status, review status with reviewer names, labels, changed files count, additions/deletions stats, and a CI/CD checks section with individual check results.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-12 09:18:16 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2026-02-12 09:36:32 | Status Change | Proposed | InProgress | Started implementation (parallel with 38-4) | AI_Agent |
| 2026-02-12 09:40:46 | Status Change | InProgress | Review | Implementation complete, ready for review | AI_Agent |
| 2026-02-12 10:01:51 | Status Change | Review | Done | Task completed and verified | AI_Agent |

## Requirements

- Display PR title below the PR number
- Show PR state (OPEN, CLOSED, MERGED) with appropriate styling
- Show draft indicator `(draft)` in dimmed style when PR is a draft
- Show mergeable status with icon: `✓ No conflicts` / `✗ Has conflicts` / `? Unknown`
- Show review status with icon and reviewer names (see PRD Section 6 for display format)
- Show labels as space-separated values in dimmed style
- Show changed files count, additions, and deletions: `12 files (+340 / -85)`
- Show individual CI/CD checks with status icons: `✓` passed, `✗` failed, `●` running, grouped under a "Checks" section header showing aggregate (e.g., `3/4 passed`)
- Add keybinding hints: `r: refresh`, `c: comments` (in addition to existing `o: open PR`, `Esc: close`)
- Increase dialog width if needed to accommodate new content
- Handle nil `PRDetail` gracefully — fall back to current display (just PR number and link)
- Ensure the dialog is scrollable if content exceeds viewport height (reuse existing scrollable dialog patterns)

## Implementation Plan

1. Modify `renderGitDetailView()` in `view.go`
2. Add a PR metadata section that renders when `PRDetail` is non-nil
3. Add styled rendering for each metadata field (title, state, draft, mergeable, review, labels, changed files)
4. Add a checks section that iterates over `PRDetail.Checks` and renders each with status icon
5. Update keybinding hints to include `r: refresh` and `c: comments`
6. Handle `r` key in the git detail view to trigger PR data refresh
7. Adjust dialog width constant to accommodate wider content
8. Ensure dialog scrolls if content overflows

## Test Plan

- Test rendering with full `PRDetail` (all fields populated)
- Test rendering with nil `PRDetail` (backward-compatible display)
- Test rendering with partial data (e.g., no checks, no labels, no reviewers)
- Test that draft indicator appears only for draft PRs
- Test that mergeable status shows correct icon for each state
- Test that review status shows correct format for each state
- Test `r` keybinding triggers PR refresh command
- Verify dialog renders without panic for edge cases (empty strings, zero values)

## Verification

- [ ] Full PR metadata displayed correctly in git detail view
- [ ] Nil PRDetail falls back to existing display
- [ ] Status icons render correctly for all check/review/merge states
- [ ] Keybinding hints updated and functional
- [ ] Dialog scrolls when content exceeds viewport
- [ ] Code quality checks pass
- [ ] Tests pass

## Files Modified

- `internal/tui/view.go` — Enhanced `renderGitDetailView()` with PR metadata (title, state, draft, merge, review, labels, changes, checks), updated keybinding hints
- `internal/tui/model.go` — Added `r` (refresh) and `c` (comments) keybindings in `updateDialog()`, added `gitPRCommentsMsg` handler in `Update()`
