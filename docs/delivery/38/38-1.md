# [38-1] Define PR Detail Data Model and Types

[Back to task list](./tasks.md)

## Description

Define the Go data structures needed to represent extended PR metadata fetched from the GitHub CLI. This includes the main `PRDetail` struct and supporting types for reviewers, CI/CD checks, and check summaries. Also define constants for status values and display indicators used across the PR integration features.

These types will be added to the `internal/git` package alongside the existing `Info` and `GitHubInfo` structs.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-12 09:18:16 | Created | N/A | Proposed | Task file created | AI_Agent |

## Requirements

- Define `PRDetail` struct with fields: Number, Title, State, Draft, Mergeable, Labels, ChangedFiles, Additions, Deletions, ReviewStatus, Reviewers, Comments (count), Checks, CheckSummary, URL, FetchedAt
- Define `Reviewer` struct with Login and State fields
- Define `Check` struct with Name, Status, and Conclusion fields
- Define `CheckSummary` struct with Total, Passed, Failed, Pending counts
- Define constants for check conclusions (success, failure, neutral, etc.)
- Define constants for review states (approved, changes requested, etc.)
- Define constants for mergeable states (mergeable, conflicting, unknown)
- Define display indicator constants for check status icons (pass, fail, pending)
- Add a `PRDetail` field to the existing `git.Info` struct (pointer, omitempty)
- Ensure JSON serialization tags are consistent with existing patterns in `git.Info`

## Implementation Plan

1. Add new type definitions to `internal/git/git.go` (or a new `internal/git/pr.go` file if the file is getting large)
2. Define `PRDetail`, `Reviewer`, `Check`, `CheckSummary` structs with JSON tags
3. Define string constants for status/conclusion/review/mergeable values
4. Define display constants for status indicators (checkmark, cross, pending dot)
5. Add `PRDetail *PRDetail` field to the existing `Info` struct
6. Add helper methods on `PRDetail`: `IsAllPassed()`, `HasFailures()`, `IsPending()`, `CheckIndicator()` for aggregate check status
7. Add `PRCacheMaxAge` constant for PR detail cache TTL (separate from git info cache)

## Test Plan

- Verify all types compile correctly
- Unit test `CheckSummary` helper methods (`IsAllPassed`, `HasFailures`, `IsPending`, `CheckIndicator`)
- Verify JSON round-trip serialization of `PRDetail` struct
- Verify `Info` struct still serializes correctly with the new `PRDetail` field (nil case and populated case)

## Verification

- [ ] All new types compile without errors
- [ ] JSON tags are consistent with existing patterns
- [ ] Helper methods return correct indicator for each check state
- [ ] Existing `git.Info` tests still pass
- [ ] Code quality checks pass

## Files Modified

<To be filled during implementation>
