# [38-6] Add PR Comment Viewer

[Back to task list](./tasks.md)

## Description

Implement a scrollable comment viewer panel that displays PR comments fetched in task 38-5. The viewer is accessed from the git detail view by pressing `c`. It renders comments with author, timestamp, and body text in a scrollable dialog, using the same scrollable content patterns established by the content viewer (PBI-29) and scrollable panels (PBI-32).

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-12 09:18:16 | Created | N/A | Proposed | Task file created | AI_Agent |

## Requirements

- Add a new view state (e.g., `showPRComments`) to the model
- Pressing `c` in the git detail view triggers comment fetching and opens the comment viewer
- Display each comment with:
  - Author name (highlighted)
  - Timestamp (dimmed, relative or absolute)
  - Comment type indicator: `[review]` for inline review comments with file:line, `[comment]` for general
  - Body text (plain text rendering)
- Comments separated by a horizontal rule or blank line
- Scrollable with `j/k` (line by line), `g/G` (top/bottom), `Ctrl+d/Ctrl+u` (half-page)
- Show scroll indicator (reuse existing scroll indicator pattern)
- `q` or `Escape` returns to the git detail view (not to session list)
- Show comment count in the dialog title: `PR Comments (5)`
- Handle empty state: show "No comments on this PR" message
- Handle loading state: show "Loading comments..." while fetch is in progress
- Dialog should be centered and sized appropriately (similar to content viewer sizing)

## Implementation Plan

1. Add `showPRComments bool` and `prComments []PRComment` fields to the model
2. Add `prCommentsScroll int` for scroll position
3. Handle `c` key in git detail view:
   - Set loading state
   - Dispatch `fetchPRCommentsCmd`
   - Transition to comment viewer when response arrives
4. Handle `gitPRCommentsMsg` in Update:
   - Store comments in model
   - Set `showPRComments = true`
   - Reset scroll position
5. Implement `renderPRCommentsView()` in view.go:
   - Render dialog with title "PR Comments (<count>)"
   - Iterate over comments, render each with author, time, type, body
   - Apply scroll offset and viewport clipping
   - Add scroll indicator
6. Handle navigation keys (j/k/g/G/Ctrl+d/Ctrl+u) in comment viewer
7. Handle q/Escape to return to git detail view
8. Handle empty and loading states

## Test Plan

- Test comment viewer renders correctly with multiple comments
- Test comment viewer shows empty state message when no comments
- Test comment viewer shows loading state
- Test scroll navigation: j/k moves one line, g/G goes to top/bottom
- Test q/Escape returns to git detail view (not session list)
- Test c keybinding triggers comment fetch from git detail view
- Test comment rendering: author, timestamp, type indicator, body all present
- Test review comments show file:line information
- Verify scroll indicator appears when content overflows

## Verification

- [ ] Comment viewer opens from git detail view via `c`
- [ ] Comments display with correct formatting
- [ ] Scrolling works correctly
- [ ] Empty state handled
- [ ] Loading state handled
- [ ] q/Escape returns to git detail view
- [ ] Code quality checks pass
- [ ] Tests pass

## Files Modified

<To be filled during implementation>
