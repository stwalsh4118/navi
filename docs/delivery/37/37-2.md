# [37-2] Header summary stats

[Back to task list](./tasks.md)

## Description

Extend the task panel header to include a status breakdown showing counts of groups in each status category. The summary counts reflect **unfiltered** totals so the user always has context of the full backlog even when filtering is added later.

Example: `12 done · 3 active · 1 review · 18 todo`

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-12 07:40:26 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2026-02-12 07:50:27 | Status Change | Proposed | InProgress | Started implementation | AI_Agent |
| 2026-02-12 07:54:11 | Status Change | InProgress | Review | Implementation complete, ready for review | AI_Agent |
| 2026-02-12 08:49:09 | Status Change | Review | Done | Task completed and verified | AI_Agent |

## Requirements

- Calculate status breakdown across all groups (counting groups by their status)
- Display summary on a second header line: `<N> done · <N> active · <N> review · <N> todo`
- Only show statuses that have a non-zero count
- Use the canonical status categories: done, active, review, blocked, todo
- Summary must always show unfiltered totals (calculate from full group list, not filtered)
- Second line only shown when panel height allows (at least 4 lines of content area)
- Apply dimmed styling to the summary line, with status-appropriate colors for the counts

## Implementation Plan

1. Add a `groupStatusSummary(groups []task.TaskGroup) map[string]int` function that counts groups by status category
2. Add a `renderStatusSummary(counts map[string]int) string` function that formats the summary line with colored counts
3. Modify `renderTaskPanelHeader()` in `taskview.go` to include the summary as a second line when panel height permits
4. Adjust viewport calculations to account for the optional second header line
5. Add unit tests for `groupStatusSummary` and `renderStatusSummary`

## Test Plan

- **groupStatusSummary**: Verify correct grouping of statuses into canonical categories (e.g., "in_progress" maps to "active", "closed" maps to "done")
- **renderStatusSummary**: Verify output format, zero-count suppression, and correct ordering
- **Header rendering**: Verify second line appears when panel is tall enough and is omitted when too short
- All existing tests continue to pass

## Verification

- [x] Status summary correctly counts groups by category
- [x] Summary line only includes non-zero statuses
- [x] Summary line is hidden when panel is too short
- [x] Summary uses unfiltered totals (preparation for 37-4)
- [x] Code quality checks pass
- [x] Tests pass

## Files Modified

- `internal/tui/taskview.go` — Rewrote `renderTaskPanelHeader()` with sort/filter/accordion/refresh indicators and status summary second line; added `groupStatusCategory()`, `groupStatusSummary()`, `renderStatusSummary()`
- `internal/tui/taskviewstate.go` — New file with `taskSortMode`, `taskFilterMode` types, sort/filter pipeline functions
- `internal/tui/model.go` — Added `taskSortMode`, `taskFilterMode`, `taskAccordionMode`, `taskRefreshing` fields; added `taskPanelHeaderLines()`; updated `taskPanelViewportLines()` for dynamic header height
- `internal/tui/taskview_summary_test.go` — New test file for summary stats functions
