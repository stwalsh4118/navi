# [37-6] Manual refresh

[Back to task list](./tasks.md)

## Description

Add an `r` keybinding to trigger immediate task data refresh, invalidating the cache and re-running the provider. Show a brief "Refreshing..." indicator in the header while the provider runs. This does not affect the auto-refresh timer.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-12 07:40:26 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2026-02-12 07:58:38 | Status Change | Proposed | InProgress | Started implementation | AI_Agent |
| 2026-02-12 07:59:39 | Status Change | InProgress | Review | Implementation complete, ready for review | AI_Agent |
| 2026-02-12 08:49:09 | Status Change | Review | Done | Task completed and verified | AI_Agent |

## Requirements

- `r` keybinding triggers immediate provider re-execution
- Invalidate the task cache for the focused project before re-executing
- Show "Refreshing..." indicator in the header area while the provider is running
- Clear the indicator when the refresh completes (on receiving `tasksMsg`)
- Does not reset or affect the auto-refresh timer
- If a refresh is already in progress, ignore subsequent `r` presses

## Implementation Plan

1. Add a `taskRefreshing bool` field to the model to track refresh state
2. Add cache invalidation: expose a method on `ResultCache` to invalidate a specific project's cache entry (or use existing mechanism)
3. Bind `r` in `updateTaskPanelFocus()`:
   - If `taskRefreshing` is true, ignore
   - Otherwise set `taskRefreshing = true` and dispatch `taskRefreshCmd()`
4. On receiving `tasksMsg`, set `taskRefreshing = false`
5. Update `renderTaskPanelHeader()` to show "Refreshing..." (dimmed, italic) when `taskRefreshing` is true
6. Add unit tests for the refresh state transitions

## Test Plan

- **Keybinding**: `r` triggers refresh command; ignored when already refreshing
- **Cache invalidation**: Verify cache entry is cleared before re-execution
- **Indicator**: "Refreshing..." shown during refresh, cleared on completion
- **Auto-refresh**: Timer is not affected by manual refresh
- All existing tests continue to pass

## Verification

- [x] `r` triggers immediate provider refresh
- [x] Cache is invalidated before refresh
- [x] "Refreshing..." indicator shown during refresh
- [x] Indicator cleared when refresh completes
- [x] Duplicate `r` presses ignored during refresh
- [x] Auto-refresh timer unaffected
- [x] No keybinding conflicts
- [x] Code quality checks pass
- [x] Tests pass

## Files Modified

- `internal/tui/model.go` — Added `r` keybinding in `updateTaskPanelFocus()` with cache invalidation; updated `tasksMsg` handler to clear `taskRefreshing`
- `internal/tui/taskview_refresh_test.go` — New test file for manual refresh functionality
