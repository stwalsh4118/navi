# [37-6] Manual refresh

[Back to task list](./tasks.md)

## Description

Add an `r` keybinding to trigger immediate task data refresh, invalidating the cache and re-running the provider. Show a brief "Refreshing..." indicator in the header while the provider runs. This does not affect the auto-refresh timer.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-12 07:40:26 | Created | N/A | Proposed | Task file created | AI_Agent |

## Requirements

- `r` keybinding triggers immediate provider re-execution
- Invalidate the task cache for the focused project before re-executing
- Show "Refreshing..." indicator in the header area while the provider is running
- Clear the indicator when the refresh completes (on receiving `tasksMsg`)
- Does not reset or affect the auto-refresh timer
- If a refresh is already in progress, ignore subsequent `r` presses

## Implementation Plan

1. Add a `taskRefreshing bool` field to the model to track refresh state
2. Add cache invalidation: expose a method on `ResultCache` to invalidate a specific project's cache entry (or use existing mechanism)
3. Bind `r` in `updateTaskPanelFocus()`:
   - If `taskRefreshing` is true, ignore
   - Otherwise set `taskRefreshing = true` and dispatch `taskRefreshCmd()`
4. On receiving `tasksMsg`, set `taskRefreshing = false`
5. Update `renderTaskPanelHeader()` to show "Refreshing..." (dimmed, italic) when `taskRefreshing` is true
6. Add unit tests for the refresh state transitions

## Test Plan

- **Keybinding**: `r` triggers refresh command; ignored when already refreshing
- **Cache invalidation**: Verify cache entry is cleared before re-execution
- **Indicator**: "Refreshing..." shown during refresh, cleared on completion
- **Auto-refresh**: Timer is not affected by manual refresh
- All existing tests continue to pass

## Verification

- [ ] `r` triggers immediate provider refresh
- [ ] Cache is invalidated before refresh
- [ ] "Refreshing..." indicator shown during refresh
- [ ] Indicator cleared when refresh completes
- [ ] Duplicate `r` presses ignored during refresh
- [ ] Auto-refresh timer unaffected
- [ ] No keybinding conflicts
- [ ] Code quality checks pass
- [ ] Tests pass

## Files Modified

