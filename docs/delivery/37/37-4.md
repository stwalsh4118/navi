# [37-4] Group filtering with search interaction

[Back to task list](./tasks.md)

## Description

Add the ability to filter task groups by status: show all (default), active-only (active/review/blocked), or incomplete-only (everything except done). The `f` key cycles through filter modes. The header shows the current filter mode and count of hidden groups. Search operates within the filtered set.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-12 07:40:26 | Created | N/A | Proposed | Task file created | AI_Agent |

## Requirements

- Add a `taskFilterMode` field to the model with values: `all`, `active`, `incomplete`
- Default filter mode is `all` (current behavior)
- **all**: Show all groups (no filtering)
- **active**: Show only groups with status active, review, or blocked
- **incomplete**: Show all groups except those with status done (or done-equivalent)
- `f` keybinding cycles: all → active → incomplete → all
- Show current filter mode in header: `filter:<mode>` with dimmed styling (only shown when not `all`)
- Show count of hidden groups when filter is active: `(N hidden)`
- Search operates within the filtered set (filtered-out groups are not searchable)
- Clearing the filter does not clear the search, and clearing the search does not clear the filter
- Cursor stability: if the currently-selected item is filtered out, move cursor to the nearest visible item
- The summary stats from 37-2 continue to show **unfiltered** totals

## Implementation Plan

1. Define a `taskFilterMode` type with constants for each mode in `model.go`
2. Add `taskFilterMode` field to the model, defaulting to `all`
3. Implement `filterGroups(groups []task.TaskGroup, mode taskFilterMode) []task.TaskGroup` that returns a filtered copy
4. Integrate filtering into the data path before `getVisibleTaskItems()`: apply filter, then sort (from 37-3), then pass to view
5. Store the unfiltered groups separately for summary stats calculation
6. Add `f` keybinding in `updateTaskPanelFocus()` to cycle filter mode
7. Update `renderTaskPanelHeader()` to show `filter:<mode>` and hidden count when filter is not `all`
8. Update search match computation to operate on the filtered+sorted item list
9. Implement cursor stability: after filter change, clamp cursor to valid range and try to preserve current item
10. Add unit tests for filter functions, search interaction, and cursor stability

## Test Plan

- **Filter all**: All groups visible, no hidden count
- **Filter active**: Only groups with active/review/blocked status shown
- **Filter incomplete**: All groups except done shown
- **Hidden count**: Correct number of hidden groups displayed
- **Search within filter**: Search only matches within filtered groups, not hidden ones
- **Search + filter independence**: Changing filter preserves search query; clearing search preserves filter
- **Cursor stability**: Cursor moves to nearest visible item when current item filtered out
- **Summary stats**: Header summary always shows unfiltered totals regardless of filter mode
- All existing tests continue to pass

## Verification

- [ ] All three filter modes produce correct group sets
- [ ] `f` keybinding cycles through modes
- [ ] Header shows filter mode and hidden count (hidden for `all`)
- [ ] Search operates within filtered set
- [ ] Search and filter are independent
- [ ] Cursor remains valid after filter changes
- [ ] Summary stats use unfiltered totals
- [ ] No keybinding conflicts
- [ ] Code quality checks pass
- [ ] Tests pass

## Files Modified

