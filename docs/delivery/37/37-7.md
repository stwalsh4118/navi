# [37-7] E2E CoS Test

[Back to task list](./tasks.md)

## Description

End-to-end verification of all PBI 37 acceptance criteria. This task validates that sorting, filtering, progress indicators, summary stats, navigation improvements, and manual refresh all work correctly together in the running TUI.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-12 07:40:26 | Created | N/A | Proposed | Task file created | AI_Agent |

## Requirements

Verify all 13 acceptance criteria from the PBI:

1. Groups can be sorted by source order, status priority, name, or progress. `s` cycles through modes. Current mode shown in header.
2. When group sort is `status`, tasks within groups are also sorted by status priority.
3. Groups can be filtered to show all, active-only, or incomplete-only. `f` cycles through modes. Current mode and hidden count shown in header.
4. Group headers show `[done/total]` with a mini progress bar for groups with tasks.
5. Header shows status breakdown across all groups (done/active/review/todo counts).
6. `J`/`K` jump between group headers, skipping tasks.
7. `e` toggles all groups expanded or collapsed.
8. `a` toggles accordion mode where expanding one group collapses others.
9. `r` triggers immediate provider re-execution and cache invalidation.
10. No keybinding conflicts with existing task panel or global keybindings.
11. Search works correctly with active filters (searches within filtered set).
12. Cursor remains on a valid item after sort/filter changes. If current item filtered out, cursor moves to nearest visible item.
13. All existing tests pass; new tests cover sorting, filtering, progress calculation, and navigation.

## Implementation Plan

1. Run full test suite (`cd api && make check`) to verify no regressions
2. Build the binary and run with a test project that has multiple task groups with varied statuses
3. Use Playwright MCP tools to verify TUI behavior if applicable, or manual verification checklist
4. Document verification results for each acceptance criterion

## Test Plan

### Objective
Verify all PBI 37 acceptance criteria are met in an integrated, running system.

### Test Scenarios

**Sorting (AC 1, 2)**:
- Cycle through all sort modes with `s`, verify group order changes correctly
- In status sort, verify tasks within groups are sorted by status priority

**Filtering (AC 3, 11)**:
- Cycle through filter modes with `f`, verify correct groups shown/hidden
- Apply filter, then search — verify search only matches within visible groups
- Clear filter, verify search state preserved; clear search, verify filter preserved

**Progress (AC 4, 5)**:
- Verify group headers show `[done/total]` and progress bars
- Verify header summary shows correct status breakdown

**Navigation (AC 6, 7, 8)**:
- Use `J`/`K` to jump between groups, verify tasks are skipped
- Use `e` to expand/collapse all, verify state
- Toggle accordion with `a`, verify expanding one group collapses others

**Refresh (AC 9)**:
- Press `r`, verify "Refreshing..." indicator, verify data updates

**Stability (AC 10, 12, 13)**:
- Verify no keybinding conflicts (all new keys work, existing keys unaffected)
- Change sort/filter while cursor is on a specific item, verify cursor stays or moves appropriately
- Run `go test -race ./...` — all tests pass

### Success Criteria
- All 13 acceptance criteria verified and passing
- No regressions in existing functionality
- All tests pass with race detector enabled

## Verification

- [ ] All 13 acceptance criteria verified
- [ ] No regressions in existing functionality
- [ ] Full test suite passes with `-race`
- [ ] Code quality checks pass

## Files Modified

