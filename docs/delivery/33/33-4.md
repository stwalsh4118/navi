# [33-4] Render inline agent team status in TUI

[Back to task list](./tasks.md)

## Description

Update the TUI to display agent team information inline within session rows. When a session has an active team, show an agent count badge on the session name line and render each agent with its status icon and name on a subordinate line. Ensure scroll calculations remain correct with variable-height session rows.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-09 19:58:48 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2026-02-09 20:10:31 | Status Change | Proposed | InProgress | Started implementation | AI_Agent |
| 2026-02-09 20:12:22 | Status Change | InProgress | Review | Implementation complete, all tests passing | AI_Agent |
| 2026-02-09 21:45:49 | Status Change | Review | Done | Task completed and verified | AI_Agent |

## Requirements

- When `session.Team` is non-nil and has agents, render team info after the existing session lines
- Add an agent count badge to line 1 of the session row, appended after the session name (e.g., `[3 agents]` in dimmed style)
- Add a team agents line (indented like other sub-lines) showing each agent with its status icon and name:
  - Format: `rowIndent + icon1 + " " + name1 + "  " + icon2 + " " + name2 + ...`
  - Use the existing `StatusIcon` function for agent statuses
- Add `"idle"` status to the `StatusIcon` function with a pause-like icon in dimmed/gray style
- Team info should be visually subordinate: use `dimStyle` for agent names
- When no team is active (`Team` is nil), render exactly as before with zero visual overhead
- The session row height increases dynamically when team info is present; audit `sessionScrollOffset` calculations and `sessionListMaxVisible` for correctness with variable row heights
- Handle line wrapping if many agents overflow the available width: wrap to next line with same indent

## Implementation Plan

1. **Update `StatusIcon`** in `internal/tui/styles.go`:
   - Add case for `"idle"` status returning a pause-like icon (e.g., `⏸` or `⏳`) with dimmed/gray styling
2. **Update `renderSession`** in `internal/tui/view.go`:
   - After existing session line rendering, check if `session.Team` is non-nil and has agents
   - If team is active, append `[N agents]` badge (dimmed) to line 1 after the session name
   - Render a team agents line: iterate over `session.Team.Agents`, concatenate `StatusIcon(agent.Status) + " " + agent.Name` separated by double spaces
   - Apply `dimStyle` to agent names for visual subordination
   - Handle width overflow: if the concatenated agent line exceeds available width, wrap to additional lines with the same indent
3. **Audit scroll calculations**:
   - Review `sessionScrollOffset` and `sessionListMaxVisible` logic in `renderSessionList`
   - Currently, if row height is assumed fixed, update to calculate actual row heights by considering whether each session has team info
   - Ensure the viewport correctly accounts for variable-height rows so all sessions remain scrollable
4. **Write tests** for the new rendering behavior

## Test Plan

### renderSession with Team Data
- Session with `Team` containing 2 agents renders agent count badge `[2 agents]` on line 1
- Session with `Team` containing agents renders each agent with correct status icon and name on the agents line
- Agent names are rendered in dimmed style
- Agents line uses correct indentation matching other sub-lines

### renderSession without Team Data
- Session with `Team` as nil renders identically to current behavior (no extra lines, no badge)
- No visual overhead or layout changes for sessions without teams

### StatusIcon for Idle
- `StatusIcon("idle")` returns an appropriate icon with dimmed/gray styling
- Existing status icons remain unchanged (no regression)

### Scroll Calculations
- Scroll offset calculations correctly account for variable row heights when some sessions have team info and others do not
- Scrolling to the bottom of the session list shows the last session fully when sessions have mixed heights
- `sessionListMaxVisible` correctly determines visible sessions with variable heights

### Line Wrapping
- When agent list exceeds available width, agents wrap to the next line with correct indentation
- Single agent renders on one line without wrapping

## Verification

- [ ] `StatusIcon` handles `"idle"` status with appropriate icon and style
- [ ] Agent count badge appears on line 1 when team is active
- [ ] Agent status icons and names render correctly on the team agents line
- [ ] Agent names use dimmed styling
- [ ] Sessions without teams render with no visual changes
- [ ] Scroll calculations work correctly with variable-height session rows
- [ ] Line wrapping works when many agents overflow the width
- [ ] All new and existing tests pass (`go test ./internal/tui/...`)

## Files Modified

- `internal/tui/styles.go` — Added `iconIdle` constant and `"idle"` case in `StatusIcon` function; added `iconStopped` constant and `"stopped"` case in `StatusIcon`
- `internal/tui/view.go` — Added team badge to `renderSession` first line (excludes stopped agents from count, shows `[team done]` when all stopped), added team agents line rendering, added `renderTeamAgents` function with line wrapping support
- `internal/tui/view_test.go` — Added `TestStatusIconIdle`, `TestStatusIconStopped`, `TestRenderSessionWithTeam`, `TestRenderTeamAgents`, stopped agent badge exclusion, and `[team done]` badge test functions
