# [33-2] Extend session data model with agent team types

[Back to task list](./tasks.md)

## Description

Add Go types for representing agent team data within session information, and update session sorting logic to account for teammate statuses. When any agent in a session's team has a priority status (permission or waiting), the parent session should be elevated in sort order.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-09 19:58:48 | Created | N/A | Proposed | Task file created | AI_Agent |

## Requirements

- Add `AgentInfo` struct with fields: `Name` (string, `json:"name"`), `Status` (string, `json:"status"`), `Timestamp` (int64, `json:"timestamp"`)
- Add `TeamInfo` struct with fields: `Name` (string, `json:"name"`), `Agents` ([]AgentInfo, `json:"agents"`)
- Add `Team *TeamInfo` field to `session.Info` with tag `json:"team,omitempty"`
- Add new status constant `StatusIdle = "idle"` for agent idle state
- Add helper function `HasPriorityTeammate(s Info) bool` that returns true if any agent in `s.Team.Agents` has status `StatusWaiting` or `StatusPermission`
- Update `SortSessions` to treat sessions where `HasPriorityTeammate` returns true as having priority status (sorted to the top alongside sessions whose own status is waiting/permission)
- No metrics tracking for agents (per user decision)
- Ensure JSON unmarshaling works correctly for the nested team structure via standard `encoding/json`

## Implementation Plan

1. **Define new types** in `internal/session/session.go`:
   - Add `AgentInfo` struct with `Name`, `Status`, `Timestamp` fields and json tags
   - Add `TeamInfo` struct with `Name`, `Agents` fields and json tags
   - Add `Team *TeamInfo` field to the existing `Info` struct
2. **Add status constant**: Add `StatusIdle = "idle"` alongside existing status constants
3. **Add helper function**: Implement `HasPriorityTeammate(s Info) bool`
   - Return false if `s.Team` is nil or `s.Team.Agents` is empty
   - Iterate over agents, return true if any agent's Status is `StatusWaiting` or `StatusPermission`
4. **Update `SortSessions`**: Modify the sorting comparator so that sessions where `HasPriorityTeammate` returns true are treated as priority sessions (same bucket as sessions with own status waiting/permission)
5. **Write tests** for the new functionality

## Test Plan

### JSON Round-Tripping
- Marshal an `Info` struct with a populated `Team` field to JSON and unmarshal back; verify all fields are preserved
- Marshal an `Info` struct with `Team` as nil; verify `"team"` key is omitted from JSON output
- Unmarshal JSON containing nested team/agent data into `Info`; verify correct struct population

### HasPriorityTeammate
- Returns false when `Team` is nil
- Returns false when `Team.Agents` is empty
- Returns false when all agents have status "working" or "idle"
- Returns true when at least one agent has status "waiting"
- Returns true when at least one agent has status "permission"

### SortSessions with Team Data
- Session with own status "working" but a teammate with status "permission" sorts above a plain "working" session with no team
- Session with own status "working" and a teammate with "waiting" sorts alongside a session with own status "waiting"
- Sessions with no team data sort identically to current behavior (no regression)
- Multiple priority sessions (own status and teammate status) maintain timestamp-based secondary sort

## Verification

- [ ] `AgentInfo`, `TeamInfo` structs defined with correct json tags
- [ ] `Team *TeamInfo` field added to `session.Info`
- [ ] `StatusIdle` constant added
- [ ] `HasPriorityTeammate` function implemented and handles nil/empty cases
- [ ] `SortSessions` updated to account for teammate priority statuses
- [ ] All new and existing tests pass (`go test ./internal/session/...`)
- [ ] No regression in existing session sorting behavior

## Files Modified

(empty - to be filled during implementation)
