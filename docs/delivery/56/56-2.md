# 56-2 Sound Pack Scanner and File Resolution

[Back to task list](./tasks.md)

## Description

Create a new `pack.go` file in `internal/audio/` that provides sound pack directory scanning, file resolution, and pack listing. The scanner reads `~/.config/navi/soundpacks/<pack-name>/` directories, detects audio files by event name with automatic extension detection (`.wav`, `.mp3`, `.ogg`), discovers multi-sound variants (`<event>-N.*`), and caches file lists at load time. Provides a `ListPacks()` function to enumerate available packs.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-19 04:44:42 | Created | N/A | Proposed | Task file created | AI_Agent |

## Requirements

1. New `PackScanner` type that scans a pack directory and builds a map of event → []filePath
2. Supported extensions: `.wav`, `.mp3`, `.ogg`, `.flac` (auto-detected, no config needed)
3. File matching patterns:
   - Single: `<event>.ext` (e.g., `waiting.wav`)
   - Multi: `<event>-<N>.ext` (e.g., `waiting-1.wav`, `waiting-2.wav`)
4. `ScanPack(packDir string) (map[string][]string, error)` — returns event → file paths
5. `ResolveSoundFiles(packName string) (map[string][]string, error)` — resolves from `~/.config/navi/soundpacks/<packName>/`
6. `ListPacks() ([]PackInfo, error)` — enumerates packs in `~/.config/navi/soundpacks/`, returns name + event count + file count
7. `PackInfo` struct: `Name string`, `EventCount int`, `FileCount int`
8. File lists cached at scan time (scan once, reuse)
9. Graceful handling: missing directory returns empty results (not error), missing pack returns error
10. Update audio API spec with new types and functions

## Implementation Plan

1. Create `internal/audio/pack.go`
2. Define `PackInfo` struct and `PackScanner` type with cached results
3. Implement `ScanPack()` — reads directory, groups files by event name, sorts by numeric suffix
4. Implement `ResolveSoundFiles()` — constructs path from `~/.config/navi/soundpacks/` + pack name, delegates to `ScanPack()`
5. Implement `ListPacks()` — enumerates subdirectories, calls `ScanPack()` for each to get counts
6. Define constant `DefaultPackDir = "~/.config/navi/soundpacks"`
7. Write unit tests with temp directories containing test files
8. Update `docs/api-specs/audio/audio-api.md`

## Test Plan

- **Single file**: Directory with `done.wav` → `{"done": ["done.wav"]}`
- **Multi file**: Directory with `waiting-1.wav`, `waiting-2.wav`, `waiting-3.mp3` → `{"waiting": [3 paths]}`
- **Mixed**: `done.wav` + `error-1.ogg` + `error-2.ogg` → two events, correct counts
- **Extension detection**: Files with `.wav`, `.mp3`, `.ogg`, `.flac` all detected; `.txt` files ignored
- **Empty directory**: Returns empty map, no error
- **Missing directory**: Returns error for specific pack, empty list for ListPacks base dir
- **ListPacks**: Two pack dirs → two PackInfo entries with correct counts

## Verification

_To be completed during implementation._

## Files Modified

_To be completed during implementation. Must include `docs/api-specs/audio/audio-api.md`._
