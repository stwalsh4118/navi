# 56-6 CLI Subcommands — navi sound test/list

[Back to task list](./tasks.md)

## Description

Add `navi sound` CLI subcommands for testing and listing sound packs. `navi sound test <event>` plays the configured sound for a specific event using the active pack and volume settings. `navi sound test-all` plays all configured event sounds sequentially. `navi sound list` enumerates available sound packs and shows which is active. These commands reuse the existing audio player infrastructure.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-19 04:44:42 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2026-02-19 05:29:53 | Status Change | Proposed | InProgress | Started implementation | AI_Agent |
| 2026-02-19 05:31:19 | Status Change | InProgress | Review | Implementation complete, internal AI review passed | AI_Agent |
| 2026-02-19 06:00:26 | Status Change | Review | Done | Task completed and verified | AI_Agent |

## Requirements

1. `navi sound test <event>` — loads config, resolves sound for the given event (using pack + files + volume), plays it synchronously, prints the file path and volume to stdout
2. `navi sound test-all` — plays all enabled trigger events sequentially with a short delay between each, prints each event name and file path
3. `navi sound list` — lists all packs in `~/.config/navi/soundpacks/`, marks the active one (from config), shows event count and file count per pack
4. Unknown event name prints error and lists valid event names
5. Missing pack directory prints helpful error message
6. Commands exit with appropriate exit codes (0 success, 1 error)
7. Integrate into existing CLI routing in `cmd/navi/main.go`

## Implementation Plan

1. Add `sound` case to CLI routing in `cmd/navi/main.go`
2. Create `internal/audio/cli.go` (or add to existing) with:
   - `RunSoundTest(event string, cfg *Config) error`
   - `RunSoundTestAll(cfg *Config) error`
   - `RunSoundList(cfg *Config) error`
3. `RunSoundTest`: load config → resolve sound → print info → play synchronously (block until done)
4. `RunSoundTestAll`: iterate triggers → play each with ~1s delay
5. `RunSoundList`: call `ListPacks()` → format table output → mark active
6. Wire commands into `main.go` subcommand routing
7. Update CLI API spec (`docs/api-specs/cli/cli-api.md`)

## Test Plan

- **test command**: With a pack configured and a valid event, plays the correct file
- **test unknown event**: Prints error message listing valid events, exits 1
- **test-all**: Plays all enabled trigger events in sequence
- **list**: Shows available packs with event/file counts, active pack marked
- **list empty**: No packs directory → prints "No sound packs found" message
- **no config**: Missing sounds.yaml → uses defaults, prints appropriate message

## Verification

- All 6 sound CLI tests pass with `-race`
- `go build ./...` and `go vet ./...` clean
- Error cases: missing args, unknown event, unknown subcommand all return exit code 1
- Happy path: list works with no packs installed (shows helpful message)

## Files Modified

- `internal/cli/sound.go` — new file: RunSound, runSoundTest, runSoundTestAll, runSoundList
- `internal/cli/sound_test.go` — new file: 6 tests for CLI error handling and validation
- `cmd/navi/main.go` — added `sound` subcommand routing
- `docs/api-specs/cli/cli-api.md` — added Sound Command section
